"use strict";(self.webpackChunkreact_frontend_init=self.webpackChunkreact_frontend_init||[]).push([[7567],{39535:function(_e,K,u){u.r(K),u.d(K,{default:function(){return Ee}});var oe=u(84136),T=u.n(oe),le=u(64581),I=u.n(le),ue=u(57566),m=u.n(ue),ce=u(52487),F=u.n(ce),he=u(90785),L=u.n(he),g=u(67294),E=u(68872),pe=u(68997),de=u(74330),Q=u(83622),O=u(67524),M=u(82257);function fe(a,n){return H.apply(this,arguments)}function H(){return H=F()(m()().mark(function a(n,t){return m()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,M.request)("/api/api/avatar/frame/exchange",T()({method:"POST",params:T()({},n)},t||{})));case 1:case"end":return r.stop()}},a)})),H.apply(this,arguments)}function Ue(a){return Z.apply(this,arguments)}function Z(){return Z=_asyncToGenerator(_regeneratorRuntime().mark(function a(n){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/api/avatar/frame/list",_objectSpread({method:"GET"},n||{})));case 1:case"end":return e.stop()}},a)})),Z.apply(this,arguments)}function ve(a,n){return G.apply(this,arguments)}function G(){return G=F()(m()().mark(function a(n,t){return m()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,M.request)("/api/api/avatar/frame/list/page/vo",T()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return r.stop()}},a)})),G.apply(this,arguments)}function me(a,n){return k.apply(this,arguments)}function k(){return k=F()(m()().mark(function a(n,t){return m()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,M.request)("/api/api/avatar/frame/set",T()({method:"POST",params:T()({},n)},t||{})));case 1:case"end":return r.stop()}},a)})),k.apply(this,arguments)}var h={container:"container___eNeKm",header:"header___ILPbq",title:"title___GXIGf",subtitle:"subtitle___oO7AP",pagination:"pagination___dpbCx",userPreview:"userPreview___ruLmy",userPoints:"userPoints___VzxGg",availablePoints:"availablePoints___mosmq",frameList:"frameList___i2Le4",frameItem:"frameItem___PjWes",framePreview:"framePreview___IQIwt",frameDisplay:"frameDisplay___IwtH6",placeholderCircle:"placeholderCircle___deM8p",avatarFrame:"avatarFrame___Bmg07",previewHover:"previewHover___KUOcQ",avatarWithFrame:"avatarWithFrame___C20xy",frameInfo:"frameInfo___DwVDZ",priceTag:"priceTag___EBuMp",purchaseButton:"purchaseButton___njf6P",previewContainer:"previewContainer___CrK8n"};var W=function(a,n){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},W(a,n)};function ge(a,n){W(a,n);function t(){this.constructor=a}a.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var j=function(){return j=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},j.apply(this,arguments)};function ye(a,n,t,e){var r,o=!1,P=0;function N(){r&&clearTimeout(r)}function $(){N(),o=!0}typeof n!="boolean"&&(e=t,t=n,n=void 0);function x(){var Y=this,_=Date.now()-P,U=arguments;if(o)return;function p(){P=Date.now(),t.apply(Y,U)}function A(){r=void 0}e&&!r&&p(),N(),e===void 0&&_>a?p():n!==!0&&(r=setTimeout(e?A:p,e===void 0?a-_:a))}return x.cancel=$,x}var D={Pixel:"Pixel",Percent:"Percent"},X={unit:D.Percent,value:.8};function J(a){return typeof a=="number"?{unit:D.Percent,value:a*100}:typeof a=="string"?a.match(/^(\d*(\.\d+)?)px$/)?{unit:D.Pixel,value:parseFloat(a)}:a.match(/^(\d*(\.\d+)?)%$/)?{unit:D.Percent,value:parseFloat(a)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),X):(console.warn("scrollThreshold should be string or number"),X)}var Se=function(a){ge(n,a);function n(t){var e=a.call(this,t)||this;return e.lastScrollTop=0,e.actionTriggered=!1,e.startY=0,e.currentY=0,e.dragging=!1,e.maxPullDownDistance=0,e.getScrollableTarget=function(){return e.props.scrollableTarget instanceof HTMLElement?e.props.scrollableTarget:typeof e.props.scrollableTarget=="string"?document.getElementById(e.props.scrollableTarget):(e.props.scrollableTarget===null&&console.warn(`You are trying to pass scrollableTarget but it is null. This might
        happen because the element may not have been added to DOM yet.
        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.
      `),null)},e.onStart=function(r){e.lastScrollTop||(e.dragging=!0,r instanceof MouseEvent?e.startY=r.pageY:r instanceof TouchEvent&&(e.startY=r.touches[0].pageY),e.currentY=e.startY,e._infScroll&&(e._infScroll.style.willChange="transform",e._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},e.onMove=function(r){e.dragging&&(r instanceof MouseEvent?e.currentY=r.pageY:r instanceof TouchEvent&&(e.currentY=r.touches[0].pageY),!(e.currentY<e.startY)&&(e.currentY-e.startY>=Number(e.props.pullDownToRefreshThreshold)&&e.setState({pullToRefreshThresholdBreached:!0}),!(e.currentY-e.startY>e.maxPullDownDistance*1.5)&&e._infScroll&&(e._infScroll.style.overflow="visible",e._infScroll.style.transform="translate3d(0px, "+(e.currentY-e.startY)+"px, 0px)")))},e.onEnd=function(){e.startY=0,e.currentY=0,e.dragging=!1,e.state.pullToRefreshThresholdBreached&&(e.props.refreshFunction&&e.props.refreshFunction(),e.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){e._infScroll&&(e._infScroll.style.overflow="auto",e._infScroll.style.transform="none",e._infScroll.style.willChange="unset")})},e.onScrollListener=function(r){typeof e.props.onScroll=="function"&&setTimeout(function(){return e.props.onScroll&&e.props.onScroll(r)},0);var o=e.props.height||e._scrollableNode?r.target:document.documentElement.scrollTop?document.documentElement:document.body;if(!e.actionTriggered){var P=e.props.inverse?e.isElementAtTop(o,e.props.scrollThreshold):e.isElementAtBottom(o,e.props.scrollThreshold);P&&e.props.hasMore&&(e.actionTriggered=!0,e.setState({showLoader:!0}),e.props.next&&e.props.next()),e.lastScrollTop=o.scrollTop}},e.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:t.dataLength},e.throttledOnScrollListener=ye(150,e.onScrollListener).bind(e),e.onStart=e.onStart.bind(e),e.onMove=e.onMove.bind(e),e.onEnd=e.onEnd.bind(e),e}return n.prototype.componentDidMount=function(){if(typeof this.props.dataLength=="undefined")throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),typeof this.props.initialScrollY=="number"&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),typeof this.props.refreshFunction!="function"))throw new Error(`Mandatory prop "refreshFunction" missing.
          Pull Down To Refresh functionality will not work
          as expected. Check README.md for usage'`)},n.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},n.prototype.componentDidUpdate=function(t){this.props.dataLength!==t.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},n.getDerivedStateFromProps=function(t,e){var r=t.dataLength!==e.prevDataLength;return r?j(j({},e),{prevDataLength:t.dataLength}):null},n.prototype.isElementAtTop=function(t,e){e===void 0&&(e=.8);var r=t===document.body||t===document.documentElement?window.screen.availHeight:t.clientHeight,o=J(e);return o.unit===D.Pixel?t.scrollTop<=o.value+r-t.scrollHeight+1:t.scrollTop<=o.value/100+r-t.scrollHeight+1},n.prototype.isElementAtBottom=function(t,e){e===void 0&&(e=.8);var r=t===document.body||t===document.documentElement?window.screen.availHeight:t.clientHeight,o=J(e);return o.unit===D.Pixel?t.scrollTop+r>=t.scrollHeight-o.value:t.scrollTop+r>=o.value/100*t.scrollHeight},n.prototype.render=function(){var t=this,e=j({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),r=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),o=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return g.createElement("div",{style:o,className:"infinite-scroll-component__outerdiv"},g.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(P){return t._infScroll=P},style:e},this.props.pullDownToRefresh&&g.createElement("div",{style:{position:"relative"},ref:function(P){return t._pullDown=P}},g.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!r&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},n}(g.Component),we=Se,s=u(85893),Pe=function(){var n,t,e,r=(0,M.useModel)("@@initialState"),o=r.initialState,P=r.setInitialState,N=(0,g.useState)([]),$=L()(N,2),x=$[0],Y=$[1],_=(0,g.useState)(null),U=L()(_,2),p=U[0],A=U[1],Te=(0,g.useState)(null),q=L()(Te,2),R=q[0],ee=q[1],Fe=(0,g.useState)(1),te=L()(Fe,2),Le=te[0],re=te[1],Ce=(0,g.useState)(0),ne=L()(Ce,2),Re=ne[0],be=ne[1],De=(0,g.useState)(!0),ae=L()(De,2),je=ae[0],se=ae[1],xe=(0,g.useState)(!0),ie=L()(xe,2),Ae=ie[0],Me=ie[1];(0,g.useEffect)(function(){var f=function(){var v=F()(m()().mark(function y(){var c;return m()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,(0,O.as)();case 3:c=i.sent,c.data&&A(c.data),i.next=10;break;case 7:i.prev=7,i.t0=i.catch(0),E.ZP.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25");case 10:case"end":return i.stop()}},y,null,[[0,7]])}));return function(){return v.apply(this,arguments)}}();f()},[]);var V=function(){var f=F()(m()().mark(function v(y){var c,w,i,C,l,b;return m()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,ve({current:y,pageSize:10});case 3:c=S.sent,c!=null&&c.data&&(y===1?(b={id:-1,name:"\u65E0\u5934\u50CF\u6846",points:0,url:"",hasOwned:!0},Y([b].concat(I()((l=c.data.records)!==null&&l!==void 0?l:[])))):Y(function(d){var z;return[].concat(I()(d),I()((z=c.data.records)!==null&&z!==void 0?z:[]))}),be(((w=Number(c.data.total))!==null&&w!==void 0?w:0)+(y===1?1:0)),Me(((i=(C=c.data.records)===null||C===void 0?void 0:C.length)!==null&&i!==void 0?i:0)>0)),S.next=10;break;case 7:S.prev=7,S.t0=S.catch(0),E.ZP.error("\u83B7\u53D6\u5934\u50CF\u6846\u5217\u8868\u5931\u8D25");case 10:return S.prev=10,se(!1),S.finish(10);case 13:case"end":return S.stop()}},v,null,[[0,7,10,13]])}));return function(y){return f.apply(this,arguments)}}();(0,g.useEffect)(function(){V(1)},[]);var Ne=function(){if(!je){se(!0);var v=Le+1;re(v),V(v)}},$e=function(){var f=F()(m()().mark(function v(y){var c,w,i,C,l,b,B;return m()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(p){d.next=3;break}return E.ZP.error("\u8BF7\u5148\u767B\u5F55"),d.abrupt("return");case 3:if(C=((c=p.points)!==null&&c!==void 0?c:0)-((w=p.usedPoints)!==null&&w!==void 0?w:0),!(C<((i=y.points)!==null&&i!==void 0?i:0))){d.next=7;break}return E.ZP.error("\u53EF\u7528\u79EF\u5206\u4E0D\u8DB3"),d.abrupt("return");case 7:return d.prev=7,d.next=10,fe({frameId:(l=y.id)!==null&&l!==void 0?l:0});case 10:if(b=d.sent,!b.data){d.next=19;break}return E.ZP.success("\u8D2D\u4E70\u6210\u529F\uFF01"),d.next=15,(0,O.as)();case 15:B=d.sent,B.data&&A(B.data),re(1),V(1);case 19:d.next=24;break;case 21:d.prev=21,d.t0=d.catch(7),E.ZP.error("\u8D2D\u4E70\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 24:case"end":return d.stop()}},v,null,[[7,21]])}));return function(y){return f.apply(this,arguments)}}(),Ye=function(){var f=F()(m()().mark(function v(y){var c,w,i;return m()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,me({frameId:(c=y.id)!==null&&c!==void 0?c:0});case 3:if(w=l.sent,!w.data){l.next=10;break}return E.ZP.success("\u8BBE\u7F6E\u6210\u529F\uFF01"),l.next=8,(0,O.as)();case 8:i=l.sent,i.data&&(A(i.data),P(function(b){return T()(T()({},b),{},{currentUser:i.data})}));case 10:l.next=15;break;case 12:l.prev=12,l.t0=l.catch(0),E.ZP.error("\u8BBE\u7F6E\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");case 15:case"end":return l.stop()}},v,null,[[0,12]])}));return function(y){return f.apply(this,arguments)}}();return(0,s.jsxs)("div",{className:h.container,children:[(0,s.jsxs)("div",{className:h.header,children:[(0,s.jsxs)("div",{className:h.title,children:[(0,s.jsx)("h1",{children:"\u5934\u50CF\u6846\u5546\u57CE"}),(0,s.jsx)("p",{className:h.subtitle,children:"\u7528\u79EF\u5206\u5151\u6362\u4E13\u5C5E\u5934\u50CF\u6846\uFF0C\u5C55\u793A\u4F60\u7684\u4E2A\u6027"})]}),(0,s.jsxs)("div",{className:h.userPreview,children:[(0,s.jsxs)("div",{className:h.avatarWithFrame,children:[(0,s.jsx)(pe.Z,{src:p==null?void 0:p.userAvatar,size:120}),R&&R.id!==-1&&(0,s.jsx)("img",{src:R.url,className:h.avatarFrame,alt:R.name})]}),(0,s.jsxs)("div",{className:h.userPoints,children:["\u5F53\u524D\u79EF\u5206\uFF1A",(n=p==null?void 0:p.points)!==null&&n!==void 0?n:0,(0,s.jsxs)("span",{className:h.availablePoints,children:["\uFF08\u53EF\u7528\uFF1A",((t=p==null?void 0:p.points)!==null&&t!==void 0?t:0)-((e=p==null?void 0:p.usedPoints)!==null&&e!==void 0?e:0),"\uFF09"]})]})]})]}),(0,s.jsx)(we,{dataLength:x.length,next:Ne,hasMore:Ae,loader:(0,s.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,s.jsx)(de.Z,{})}),endMessage:(0,s.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"#999"},children:"\u6CA1\u6709\u66F4\u591A\u5934\u50CF\u6846\u4E86"}),children:(0,s.jsx)("div",{className:h.frameList,children:x.map(function(f){return(0,s.jsxs)("div",{className:h.frameItem,onMouseEnter:function(){return ee(f)},onMouseLeave:function(){return ee(null)},children:[(0,s.jsx)("div",{className:h.framePreview,children:(0,s.jsxs)("div",{className:h.frameDisplay,children:[(0,s.jsx)("div",{className:h.placeholderCircle}),f.id!==-1&&(0,s.jsx)("img",{src:f.url,className:h.avatarFrame,alt:f.name})]})}),(0,s.jsxs)("div",{className:h.frameInfo,children:[(0,s.jsxs)("div",{className:h.priceTag,children:[f.points," \u79EF\u5206"]}),f.hasOwned?(0,s.jsx)(Q.ZP,{type:"primary",onClick:function(){return Ye(f)},className:h.purchaseButton,children:"\u4F7F\u7528"}):(0,s.jsx)(Q.ZP,{type:"default",danger:!0,onClick:function(){return $e(f)},className:h.purchaseButton,children:"\u7ACB\u5373\u5151\u6362"})]})]},f.id)})})})]})},Ee=Pe}}]);
