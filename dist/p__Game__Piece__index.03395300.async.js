!(function(){"use strict";var la=Object.defineProperty,oa=Object.defineProperties;var ia=Object.getOwnPropertyDescriptors;var Re=Object.getOwnPropertySymbols;var Yt=Object.prototype.hasOwnProperty,qt=Object.prototype.propertyIsEnumerable;var Qt=(y,m,a)=>m in y?la(y,m,{enumerable:!0,configurable:!0,writable:!0,value:a}):y[m]=a,We=(y,m)=>{for(var a in m||(m={}))Yt.call(m,a)&&Qt(y,a,m[a]);if(Re)for(var a of Re(m))qt.call(m,a)&&Qt(y,a,m[a]);return y},en=(y,m)=>oa(y,ia(m));var Je=(y,m)=>{var a={};for(var f in y)Yt.call(y,f)&&m.indexOf(f)<0&&(a[f]=y[f]);if(y!=null&&Re)for(var f of Re(y))m.indexOf(f)<0&&qt.call(y,f)&&(a[f]=y[f]);return a};(self.webpackChunkreact_frontend_init=self.webpackChunkreact_frontend_init||[]).push([[747],{91373:function(y,m,a){a.d(m,{Z:function(){return I}});var f=a(67294);const W=J=>J.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),O=(...J)=>J.filter((o,l,e)=>!!o&&o.trim()!==""&&e.indexOf(o)===l).join(" ").trim();var Q={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const we=(0,f.forwardRef)((i,U)=>{var g=i,{color:J="currentColor",size:o=24,strokeWidth:l=2,absoluteStrokeWidth:e,className:ve="",children:H,iconNode:P}=g,w=Je(g,["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"]);return(0,f.createElement)("svg",We(en(We({ref:U},Q),{width:o,height:o,stroke:J,strokeWidth:e?Number(l)*24/Number(o):l,className:O("lucide",ve)}),w),[...P.map(([$,ne])=>(0,f.createElement)($,ne)),...Array.isArray(H)?H:[H]])});const I=(J,o)=>{const l=(0,f.forwardRef)((P,H)=>{var w=P,{className:e}=w,ve=Je(w,["className"]);return(0,f.createElement)(we,We({ref:H,iconNode:o,className:O(`lucide-${W(J)}`,e)},ve))});return l.displayName=`${J}`,l}},53219:function(y,m,a){a.d(m,{Z:function(){return O}});var f=a(91373);const W=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],O=(0,f.Z)("ArrowLeft",W)},47737:function(y,m,a){a.d(m,{Z:function(){return O}});var f=a(91373);const W=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],O=(0,f.Z)("MessageSquare",W)},30713:function(y,m,a){a.d(m,{Z:function(){return O}});var f=a(91373);const W=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],O=(0,f.Z)("RotateCcw",W)},43777:function(y,m,a){a.d(m,{Z:function(){return O}});var f=a(91373);const W=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],O=(0,f.Z)("Timer",W)},1470:function(y,m,a){a.d(m,{Z:function(){return O}});var f=a(91373);const W=[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]],O=(0,f.Z)("Trophy",W)},41352:function(y,m,a){a.d(m,{Z:function(){return O}});var f=a(91373);const W=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],O=(0,f.Z)("X",W)},46160:function(y,m,a){a.r(m),a.d(m,{default:function(){return vn}});var f=a(9264),W=a.n(f),O=a(63894),Q=a.n(O),we=a(79810),I=a.n(we),J=a(52419),o=a.n(J),l=a(67294),e=a(85893);function ve(c){var u=c.value,k=c.onClick,N=c.isDisabled,v=c.isLastMove,x=c.isOpponentLastMove,L=c.isWinningPiece,S=c.size,E=Math.floor(S*.8),p=Math.floor(S*.2);return(0,e.jsx)("button",{onClick:k,style:{width:S,height:S},className:`
        border border-amber-200
        relative flex items-center justify-center
        `.concat(!u&&!N?"hover:bg-amber-100":"",`
        transition-colors
        `).concat(u?"cursor-default":N?"cursor-not-allowed":"cursor-pointer",`
      `),children:u&&(0,e.jsx)("div",{style:{width:E,height:E},className:`
            rounded-full relative
            `.concat(u==="black"?"bg-gray-900 shadow-lg":"bg-white border-2 border-gray-900 shadow-md",`
            transform transition-transform
            `).concat("hover:scale-105",`
            `).concat(L?"ring-2 ring-red-500 ring-offset-2 animate-pulse":"",`
          `),children:(v||x)&&(0,e.jsx)("div",{style:{width:p,height:p},className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rounded-full bg-red-500 animate-pulse shadow-lg shadow-red-500/50"})})})}var H=Array.from({length:15},function(c,u){return String.fromCharCode(65+u)}),P=Array.from({length:15},function(c,u){return(15-u).toString()}),w=a(62412),U=a.n(w),i=15;function g(){return Array(i).fill(null).map(function(){return Array(i).fill(null)})}function $(c,u){return c>=0&&c<i&&u>=0&&u<i}function ne(c,u,k){for(var N=[[1,0],[0,1],[1,1],[1,-1]],v=0,x=N;v<x.length;v++){for(var L=o()(x[v],2),S=L[0],E=L[1],p=[u],M=1;M<5;M++){var A=u.row+S*M,R=u.col+E*M;if(!$(A,R)||c[A][R]!==k)break;p.push({row:A,col:R})}for(var C=1;C<5;C++){var b=u.row-S*C,s=u.col-E*C;if(!$(b,s)||c[b][s]!==k)break;p.push({row:b,col:s})}if(p.length>=5)return{positions:p.slice(0,5),player:k}}return null}var Be=[{own:4,empty:1,opponent:0,score:1e5},{own:3,empty:2,opponent:0,score:5e4},{own:3,empty:1,opponent:0,score:25e3},{own:2,empty:3,opponent:0,score:1e4},{own:2,empty:2,opponent:0,score:5e3},{own:1,empty:4,opponent:0,score:1e3},{own:3,empty:1,opponent:1,score:900},{own:2,empty:2,opponent:1,score:400},{own:1,empty:3,opponent:1,score:50}];function xe(c,u,k,N,v){for(var x=0,L=v==="black"?"white":"black",S=-4;S<=0;S++){for(var E=0,p=0,M=0,A=0,R=0,C=0;C<5;C++){var b=u.row+(S+C)*k,s=u.col+(S+C)*N;if(!$(b,s)){M++,A=0;continue}var F=c[b][s];F===v?(E++,A++,R=Math.max(R,A)):F===L?(M++,A=0):(p++,A=0)}var _=U()(Be),n;try{for(_.s();!(n=_.n()).done;){var K=n.value;if(E===K.own&&p===K.empty&&M===K.opponent){x+=K.score*(R+1);break}}}catch(ae){_.e(ae)}finally{_.f()}E>=2&&p>=2&&(x+=Math.pow(E,3)*20),E===3&&p===2&&(x+=3e4)}return x}function tn(c,u,k){if(c[u.row][u.col]!==null)return-1;var N=[[1,0],[0,1],[1,1],[1,-1]],v=0,x=k==="black"?"white":"black",L=Math.abs(u.row-i/2)+Math.abs(u.col-i/2);v+=(i-L)*5;for(var S=0,E=0,p=N;E<p.length;E++){var M=o()(p[E],2),A=M[0],R=M[1],C=xe(c,u,A,R,k);S=Math.max(S,C),v+=C;var b=xe(c,u,A,R,x);b>=1e4&&(v+=b*1.5)}S>=25e3&&(v*=1.5);for(var s=0,F=0,_=0,n=-2;n<=2;n++)for(var K=-2;K<=2;K++)if(!(n===0&&K===0)){var ae=u.row+n,h=u.col+K;if($(ae,h)){var se=c[ae][h];se===k?(F++,s++):se===x&&(_++,s++)}}return v+=F*100,_>F&&(v+=(_-F)*150),v}function Xe(c,u,k){var N=c.map(function(v){return Q()(v)});return N[u.row][u.col]=k,N}function nn(c){for(var u="white",k=-1,N=[],v=0;v<i;v++)for(var x=0;x<i;x++)if(c[v][x]===null){var L={row:v,col:x},S=Xe(c,L,u);if(ne(S,L,u))return L}for(var E="black",p=0;p<i;p++)for(var M=0;M<i;M++)if(c[p][M]===null){var A={row:p,col:M},R=Xe(c,A,E);if(ne(R,A,E))return A}for(var C=0;C<i;C++)for(var b=0;b<i;b++)if(c[C][b]===null){var s={row:C,col:b},F=tn(c,s,u);F>k?(k=F,N=[s]):F===k&&N.push(s)}return N.length>1&&N.sort(function(_,n){var K=Math.abs(_.row-i/2)+Math.abs(_.col-i/2),ae=Math.abs(n.row-i/2)+Math.abs(n.col-i/2);return K-ae}),N[0]}function an(c){var u=c.board,k=c.onMove,N=c.disabled,v=c.lastMove,x=c.opponentLastMove,L=c.winningLine,S=(0,l.useRef)(null),E=(0,l.useState)(40),p=o()(E,2),M=p[0],A=p[1];(0,l.useEffect)(function(){var b=function(){var F;if(S.current){var _=((F=S.current.parentElement)===null||F===void 0?void 0:F.clientWidth)||600,n=_-32-40,K=Math.floor(n/i);A(K)}};return b(),window.addEventListener("resize",b),function(){return window.removeEventListener("resize",b)}},[]);var R=function(s,F){return L?L.positions.some(function(_){return _.row===s&&_.col===F}):!1},C=M;return(0,e.jsxs)("div",{ref:S,className:"inline-block bg-gradient-to-br from-amber-50 to-orange-50 p-4 rounded-xl",children:[(0,e.jsxs)("div",{className:"flex",children:[(0,e.jsx)("div",{style:{width:C}}),H.map(function(b){return(0,e.jsx)("div",{style:{width:M,height:C},className:"flex items-center justify-center font-medium text-gray-600 text-sm",children:b},b)})]}),(0,e.jsx)("div",{className:"grid gap-0",children:u.map(function(b,s){return(0,e.jsxs)("div",{className:"flex",children:[(0,e.jsx)("div",{style:{width:C,height:M},className:"flex items-center justify-center font-medium text-gray-600 text-sm",children:P[s]}),b.map(function(F,_){return(0,e.jsx)(ve,{value:F,position:{row:s,col:_},onClick:function(){!N&&!F&&k({row:s,col:_})},isDisabled:N,isLastMove:(v==null?void 0:v.row)===s&&(v==null?void 0:v.col)===_,isOpponentLastMove:(x==null?void 0:x.row)===s&&(x==null?void 0:x.col)===_,isWinningPiece:R(s,_),size:M},"".concat(s,"-").concat(_))})]},s)})})]})}var Qe=a(53219),sn=a(30713),Ye=a(1470),Ze=a(43777),rn=a(91373);const ln=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],on=(0,rn.Z)("Brain",ln);var un=a(47737),qe=a(41352),cn=a(68872),et=a(55102),He=a(83622),tt=a(17788),dn=a(52926),z=a(86492);function mn(){var c,u,k,N,v,x,L,S,E,p,M,A,R,C,b=(0,dn.useModel)("@@initialState"),s=b.initialState,F=b.setInitialState,_=s||{},n=_.currentUser,K=(0,l.useState)((s==null||(c=s.gameState)===null||c===void 0?void 0:c.mode)||"single"),ae=o()(K,2),h=ae[0],se=ae[1],fn=(0,l.useState)((s==null||(u=s.gameState)===null||u===void 0?void 0:u.onlineStatus)||"connecting"),nt=o()(fn,2),Y=nt[0],at=nt[1],hn=(0,l.useState)((s==null||(k=s.gameState)===null||k===void 0?void 0:k.roomId)||""),st=o()(hn,2),X=st[0],Ne=st[1],gn=(0,l.useState)((s==null||(N=s.gameState)===null||N===void 0?void 0:N.opponentColor)||"white"),rt=o()(gn,2),pe=rt[0],lt=rt[1],xn=(0,l.useState)((s==null||(v=s.gameState)===null||v===void 0?void 0:v.opponentUserId)||""),ot=o()(xn,2),fe=ot[0],pn=ot[1],bn=(0,l.useState)((s==null||(x=s.gameState)===null||x===void 0?void 0:x.opponentInfo)||null),it=o()(bn,2),ue=it[0],ut=it[1],yn=(0,l.useState)((s==null||(L=s.gameState)===null||L===void 0?void 0:L.playerColor)||"black"),ct=o()(yn,2),j=ct[0],Me=ct[1],Sn=(0,l.useState)((s==null||(S=s.gameState)===null||S===void 0?void 0:S.gameStarted)||!1),dt=o()(Sn,2),he=dt[0],Ce=dt[1],jn=cn.ZP.useMessage(),mt=o()(jn,2),re=mt[0],vt=mt[1],wn=(0,l.useState)("black"),ft=o()(wn,2),V=ft[0],q=ft[1],Nn=(0,l.useState)((s==null||(E=s.gameState)===null||E===void 0?void 0:E.winner)||null),ht=o()(Nn,2),Z=ht[0],le=ht[1],Mn=(0,l.useState)(!1),gt=o()(Mn,2),be=gt[0],Ie=gt[1],Cn=(0,l.useState)((s==null||(p=s.gameState)===null||p===void 0?void 0:p.moves)||[]),xt=o()(Cn,2),ee=xt[0],ce=xt[1],_n=(0,l.useState)((s==null||(M=s.gameState)===null||M===void 0?void 0:M.lastMove)||null),pt=o()(_n,2),Ue=pt[0],de=pt[1],En=(0,l.useState)((s==null||(A=s.gameState)===null||A===void 0?void 0:A.opponentLastMove)||null),bt=o()(En,2),$e=bt[0],ge=bt[1],kn=(0,l.useState)((s==null||(R=s.gameState)===null||R===void 0?void 0:R.winningLine)||null),yt=o()(kn,2),ze=yt[0],oe=yt[1],Fn=(0,l.useState)(!1),St=o()(Fn,2),Dn=St[0],_e=St[1],Tn=(0,l.useState)(localStorage.getItem("piece_join_status")||"old"),jt=o()(Tn,2),An=jt[0],ua=jt[1],Bn=(0,l.useState)(An==="old"&&(s==null||(C=s.gameState)===null||C===void 0?void 0:C.board)||g()),wt=o()(Bn,2),G=wt[0],te=wt[1],In=(0,l.useState)(!1),Nt=o()(In,2),Pn=Nt[0],Ee=Nt[1],Ln=(0,l.useState)(!1),Mt=o()(Ln,2),ca=Mt[0],ye=Mt[1],On=(0,l.useState)(!1),Ct=o()(On,2),da=Ct[0],Se=Ct[1],Rn=(0,l.useState)(!1),_t=o()(Rn,2),Wn=_t[0],ke=_t[1],Zn=(0,l.useState)(!1),Et=o()(Zn,2),Hn=Et[0],Fe=Et[1],Un=(0,l.useState)(Date.now()),kt=o()(Un,2),ma=kt[0],De=kt[1],$n=(0,l.useState)(Date.now()),Ft=o()($n,2),va=Ft[0],Te=Ft[1],D=(0,l.useRef)(null),T=(0,l.useRef)(null),me=3e4,zn=(0,l.useState)(!0),Dt=o()(zn,2),fa=Dt[0],ha=Dt[1],Kn=(0,l.useState)([]),Tt=o()(Kn,2),At=Tt[0],Pe=Tt[1],Vn=(0,l.useState)(""),Bt=o()(Vn,2),Ke=Bt[0],Le=Bt[1],Gn=(0,l.useState)("chat"),It=o()(Gn,2),Oe=It[0],Pt=It[1],Jn=(0,l.useState)(!1),Lt=o()(Jn,2),Ve=Lt[0],Ot=Lt[1],Xn=(0,l.useState)(0),Rt=o()(Xn,2),Qn=Rt[0],Wt=Rt[1],Zt=(0,l.useRef)(null);(0,l.useEffect)(function(){var r=window.location,t=new URLSearchParams(r.search),d=t.get("roomId"),B=t.get("mode");d&&(Ne(d),se("online"),z.o.send({type:2,userId:-1,data:{type:"joinRoom",content:d}})),B&&se(B)},[]);var ie=(0,l.useCallback)(function(){h==="online"&&F(function(r){return I()(I()({},r),{},{gameState:{mode:h,onlineStatus:Y,roomId:X,opponentColor:pe,opponentUserId:fe,opponentInfo:ue,playerColor:j,gameStarted:he,board:G,moves:ee,lastMove:Ue,opponentLastMove:$e,winningLine:ze,winner:Z}})})},[h,Y,X,pe,fe,ue,j,he,G,ee,Ue,$e,ze,Z,F]);(0,l.useEffect)(function(){return function(){ie()}},[ie]);var Ge=function(t,d){ce(function(B){return[].concat(Q()(B),[I()(I()({},t),{},{player:d,number:B.length+1})])})},Yn=function(t,d){var B=Q()(G);lt(d),B[t.row][t.col]=d,te(B),Ge(t,d),ge(t),ye(!1),De(Date.now()),D.current&&(clearTimeout(D.current),D.current=null);var Ae=ne(B,t,d);Ae?(le(d),oe(Ae),h==="online"&&Ee(!0)):(Me(d==="black"?"white":"black"),q(d==="black"?"white":"black"),Te(Date.now()),T.current&&clearTimeout(T.current),T.current=setTimeout(function(){Se(!0),Fe(!0)},me)),ie()},qn=function(){var t;(t=Zt.current)===null||t===void 0||t.scrollIntoView({behavior:"smooth"})};(0,l.useEffect)(function(){qn()},[At]);var Ht=function(t){var d=t.data.message;d.sender.id!==String(n==null?void 0:n.id)&&Pe(function(B){return[].concat(Q()(B),[I()({},d)])})},Ut=function(t){localStorage.setItem("piece_join_status","old"),le(null),ce([]),de(null),ge(null),oe(null),ye(!1),Se(!1),ke(!1),Fe(!1),De(Date.now()),Te(Date.now()),D.current&&(clearTimeout(D.current),D.current=null),T.current&&(clearTimeout(T.current),T.current=null),lt(t.data.opponentColor),Me(t.data.yourColor),at("playing"),Ce(!0),pn(t.data.playerId),ut(t.data.playerInfo),t.data.yourColor==="white"?(te(g()),q("black"),De(Date.now()),D.current&&clearTimeout(D.current),D.current=setTimeout(function(){ye(!0),ke(!0)},me)):(Te(Date.now()),T.current&&clearTimeout(T.current),T.current=setTimeout(function(){Se(!0),Fe(!0)},me)),re.open({type:"success",content:"\u6218\u6597\u5F00\u59CB\uFF01\uFF01\uFF01"}),ie()},$t=function(t){console.log("\u521B\u5EFA\u623F\u95F4\u6210\u529F",t.data);var d="";W()(t.data)==="object"&&t.data!==null?(d=t.data.roomId||"",console.log("\u6536\u5230\u670D\u52A1\u5668\u8FD4\u56DE\u7684\u623F\u95F4ID: ".concat(d))):d=String(t.data),Ne(d),at("waiting"),re.open({type:"success",content:"\u623F\u95F4\u521B\u5EFA\u6210\u529F\u5566"}),Ce(!0),ie()},zt=function(t){Me(t.data.player==="black"?"white":"black"),Yn(t.data.position,t.data.player),t.data.playerInfo&&ut(t.data.playerInfo),ie()},Kt=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;ke(!1),ye(!1),t&&Xt()},Vt=function(){Fe(!1),Se(!1)};(0,l.useEffect)(function(){if(h==="online"){var r=localStorage.getItem("tokenValue");if(!r||!(n!=null&&n.id)){re.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}return z.o.addMessageHandler("chat",Ht),z.o.addMessageHandler("joinSuccess",Ut),z.o.addMessageHandler("createChessRoom",$t),z.o.addMessageHandler("moveChess",zt),z.o.connect(r),function(){z.o.removeMessageHandler("chat",Ht),z.o.removeMessageHandler("joinSuccess",Ut),z.o.removeMessageHandler("createChessRoom",$t),z.o.removeMessageHandler("moveChess",zt)}}},[h,n==null?void 0:n.id]);var je=(0,l.useCallback)(function(r){if(h==="single"){if(Z||G[r.row][r.col])return;var t=G.map(function(ra){return Q()(ra)});t[r.row][r.col]=V,te(t),de(r),Ge(r,V);var d=ne(t,r,V);if(d){le(V),oe(d),ie();return}q(V==="black"?"white":"black")}else{if(Y!=="playing"){re.open({type:"info",content:"\u5BF9\u624B\u8FD8\u6CA1\u52A0\u5165\u5462\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\uFF5E"});return}if(V!==j||Z)return;Se(!1),Te(Date.now()),T.current&&(clearTimeout(T.current),T.current=null),De(Date.now()),D.current&&clearTimeout(D.current),D.current=setTimeout(function(){ye(!0),ke(!0)},me),z.o.send({type:2,userId:fe,data:{type:"moveChess",content:{roomId:X,position:r,player:j,playerInfo:{id:n==null?void 0:n.id,name:n==null?void 0:n.userName,avatar:n==null?void 0:n.userAvatar,level:n==null?void 0:n.level}}}});var B=Q()(G);B[r.row][r.col]=j,te(B),Ge(r,j);var Ae=ne(B,r,j);Ae&&(le(j),oe(Ae),Ee(!0)),q(pe),ie()}},[G,Z,Y,h,V,j,pe,X,re,ie,n,fe,D,T,me]);(0,l.useEffect)(function(){if(he&&V!==j&&!Z){Ie(!0);var r=setTimeout(function(){var t=nn(G);je(t),Ie(!1)},500);return function(){return clearTimeout(r)}}},[h,X,V,G,Z,pe,j,he,je]);var ea=function(){var t=j==="black"?"white":"black";if(t==="white"){var d=Math.floor(G.length/2);je({row:d,col:d})}Me(t),te(g()),q("black"),le(null),Ie(!1),ce([]),de(null),ge(null),oe(null),_e(!1)},ta=function(){if(te(g()),q("black"),le(null),Ie(!1),ce([]),de(null),ge(null),oe(null),_e(!1),j==="white"){var t=Math.floor(G.length/2);setTimeout(function(){return je({row:t,col:t})},0)}},na=function(){if(!(ee.length<2||be||Z)){var t=ee.slice(0,-2);ce(t);var d=g();t.forEach(function(B){d[B.row][B.col]=B.player}),te(d),q(j),de(t.length>0?t[t.length-1]:null)}},Gt=function(t){if(Me(t),Ce(!0),te(g()),q("black"),le(null),ce([]),de(null),ge(null),oe(null),t==="white"&&h==="single"){var d=Math.floor(G.length/2);je({row:d,col:d})}},aa=function(t){var d=H[t.col],B=P[t.row];return"".concat(t.number,". ").concat(t.player==="black"?"\u25CF":"\u25CB"," ").concat(d).concat(B)},Jt=function(){if(Ke.trim()){if(!(n!=null&&n.id)){re.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}var t={id:"".concat(Date.now()),content:Ke,sender:{id:String(n.id),name:n.userName||"\u6E38\u5BA2",avatar:n.userAvatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:n.level||1,isAdmin:n.userRole==="admin"},timestamp:new Date};z.o.send({type:2,userId:-1,data:{type:"chat",content:{message:t}}}),Pe(function(d){return[].concat(Q()(d),[t])}),Le("")}},sa=function(){if(!(n!=null&&n.id)){re.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}if(Ve){re.warning("\u4F60\u5DF2\u7ECF\u53D1\u9001\u8FC7\u9080\u8BF7\u4E86\uFF0C\u8BF7\u7B49\u5F8560\u79D2\u540E\u518D\u8BD5");return}z.o.send({type:2,userId:-1,data:{type:"chat",content:{message:{id:"".concat(Date.now()),content:"[invite/chess]".concat(X,"[/invite]"),sender:{id:String(n.id),name:n.userName||"\u6E38\u5BA2",avatar:n.userAvatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:n.level||1,isAdmin:n.userRole==="admin"},timestamp:new Date}}}}),Ot(!0),Wt(60),re.success("\u9080\u8BF7\u5DF2\u53D1\u9001\u5230\u804A\u5929\u5BA4");var t=setInterval(function(){Wt(function(d){return d<=1?(clearInterval(t),Ot(!1),0):d-1})},1e3)},Xt=function(){Ce(!1),se("single"),te(g()),q("black"),le(null),ce([]),de(null),ge(null),oe(null),Pe([]),Le(""),Ne(""),Ee(!1)},ga=function(){Ee(!1)};return(0,l.useEffect)(function(){return function(){D.current&&clearTimeout(D.current),T.current&&clearTimeout(T.current)}},[]),(0,l.useEffect)(function(){h==="online"&&he&&Y==="playing"&&(V===j?(Te(Date.now()),T.current&&clearTimeout(T.current),T.current=setTimeout(function(){Se(!0),Fe(!0)},me)):(De(Date.now()),D.current&&clearTimeout(D.current),D.current=setTimeout(function(){ye(!0),ke(!0)},me)))},[h,he,Y,V,j,D,T,me]),(0,l.useEffect)(function(){Z&&(D.current&&(clearTimeout(D.current),D.current=null),T.current&&(clearTimeout(T.current),T.current=null))},[Z,D,T]),he?(0,e.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 flex items-center",children:[(0,e.jsx)("div",{className:"w-full max-w-7xl mx-auto px-4",children:(0,e.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-stretch",children:[(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-4",children:[h==="online"&&(0,e.jsx)("div",{className:"mb-3 bg-purple-50 border border-purple-100 rounded-lg p-3",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(Y==="playing"?"bg-green-500":"bg-yellow-500")}),(0,e.jsxs)("span",{className:"text-sm text-purple-800",children:[Y==="connecting"&&"\u8FDE\u63A5\u4E2D...",Y==="waiting"&&(0,e.jsxs)("span",{children:["\u7B49\u5F85\u5BF9\u624B\u52A0\u5165 ",X&&(0,e.jsxs)("span",{className:"font-medium",children:["(\u623F\u95F4\u53F7\u{1F3E0}: ",X,")"]})]}),Y==="playing"&&"\u5BF9\u6218\u4E2D - \u4F60\u6267".concat(j==="black"?"\u9ED1":"\u767D","\u68CB")]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[Y==="waiting"&&(0,e.jsx)(He.ZP,{type:"primary",size:"small",onClick:sa,disabled:Ve,className:"bg-purple-500 hover:bg-purple-600",children:Ve?"\u51B7\u5374\u4E2D (".concat(Qn,"s)"):"\u53D1\u9001\u9080\u8BF7"}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden",children:(0,e.jsx)("img",{src:(ue==null?void 0:ue.avatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(fe||"opponent"),alt:"\u5BF9\u624B\u5934\u50CF",className:"w-full h-full object-cover"})}),(0,e.jsxs)("div",{className:"text-right",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-800",children:(ue==null?void 0:ue.name)||(fe?"\u5BF9\u624B ".concat(fe.slice(-4)):"\u7B49\u5F85\u5BF9\u624B...")}),(0,e.jsx)("div",{className:"text-xs text-gray-500",children:pe==="black"?"\u6267\u9ED1\u5148\u624B":"\u6267\u767D\u540E\u624B"})]})]}),(0,e.jsx)("div",{className:"w-px h-8 bg-gray-200"}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsxs)("div",{className:"text-right",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-800",children:(n==null?void 0:n.userName)||"\u6E38\u5BA2"}),(0,e.jsx)("div",{className:"text-xs text-gray-500",children:j==="black"?"\u6267\u9ED1\u5148\u624B":"\u6267\u767D\u540E\u624B"})]}),(0,e.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden",children:(0,e.jsx)("img",{src:(n==null?void 0:n.userAvatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat((n==null?void 0:n.id)||"visitor"),alt:"\u73A9\u5BB6\u5934\u50CF",className:"w-full h-full object-cover"})})]})]})]})}),vt,(0,e.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,e.jsxs)("button",{onClick:function(){Ce(!1),se("single"),te(g()),q("black"),le(null),ce([]),de(null),ge(null),oe(null),Pe([]),Le(""),Ne("")},className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[(0,e.jsx)(Qe.Z,{className:"w-5 h-5"}),(0,e.jsx)("span",{className:"font-medium",children:"\u8FD4\u56DE"})]}),h==="single"&&(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"\u4E94\u5B50\u68CB Gomoku"}),(0,e.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,e.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(be?"bg-green-500 animate-pulse":"bg-gray-300")}),(0,e.jsx)("span",{className:"text-sm text-gray-600",children:be?"AI \u601D\u8003\u4E2D...":"\u7B49\u5F85\u843D\u5B50"})]})]}),h==="single"&&(0,e.jsxs)("div",{className:"flex gap-3",children:[(0,e.jsxs)("button",{type:"button",onClick:na,disabled:ee.length<2||be||!!Z,className:"px-4 py-2 rounded-lg flex items-center gap-2 ".concat(ee.length<2||be||Z?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"," transition-colors"),children:[(0,e.jsx)(Qe.Z,{className:"w-4 h-4"}),(0,e.jsx)("span",{className:"font-medium",children:"\u6094\u68CB"})]}),(0,e.jsxs)("button",{type:"button",onClick:function(){return _e(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,e.jsx)(sn.Z,{className:"w-4 h-4"}),(0,e.jsx)("span",{className:"font-medium",children:"\u91CD\u65B0\u5F00\u59CB"})]})]})]}),Z&&(0,e.jsxs)("div",{className:"mb-3 bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-center justify-center gap-3",children:[(0,e.jsx)(Ye.Z,{className:"w-6 h-6 text-yellow-600"}),(0,e.jsx)("span",{className:"text-lg font-medium text-yellow-800",children:Z===j?"\u606D\u559C\u4F60\u8D62\u4E86\uFF01":h==="online"?"\u5BF9\u624B\u5C0F\u80DC\uFF0C\u518D\u63A5\u518D\u5389":"AI \u8D62\u4E86\uFF0C\u518D\u63A5\u518D\u5389\uFF01"})]}),!Z&&(0,e.jsxs)("div",{className:"mb-3 bg-blue-50 border border-blue-100 rounded-lg p-3 flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("div",{className:"w-8 h-8 rounded-full ".concat(V==="black"?"bg-gray-900":"bg-white border-2 border-gray-900")}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"font-medium text-gray-900",children:V===j?"\u4F60\u7684\u56DE\u5408":"\u5BF9\u624B \u56DE\u5408"}),(0,e.jsx)("div",{className:"text-sm text-gray-600",children:V==="black"?"\u9ED1\u68CB":"\u767D\u68CB"})]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-4 text-gray-600",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(Ze.Z,{className:"w-5 h-5"}),(0,e.jsxs)("span",{children:["\u56DE\u5408 ",ee.length+1]})]}),h==="single"&&(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(on,{className:"w-5 h-5"}),(0,e.jsx)("span",{children:"AI \u96BE\u5EA6: \u9AD8\u7EA7"})]})]})]}),(0,e.jsx)("div",{className:"flex justify-center",children:(0,e.jsx)(an,{board:G,onMove:je,disabled:be||V!==j||!!Z,lastMove:Ue,opponentLastMove:$e,winningLine:ze})})]})}),(h==="online"||h==="single")&&(0,e.jsx)("div",{className:"lg:w-96 w-full flex items-center",children:(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 flex flex-col w-full",style:{height:"min(calc(100vh - 6rem), 800px)"},children:[h==="online"&&(0,e.jsxs)("div",{className:"flex border-b mb-6",children:[(0,e.jsx)("button",{onClick:function(){return Pt("chat")},className:"flex-1 py-3 px-4 text-center font-medium transition-all duration-200 ".concat(Oe==="chat"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:(0,e.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,e.jsx)(un.Z,{className:"w-4 h-4"}),(0,e.jsx)("span",{children:"\u804A\u5929\u5BA4"})]})}),(0,e.jsx)("button",{onClick:function(){return Pt("history")},className:"flex-1 py-3 px-4 text-center font-medium transition-all duration-200 ".concat(Oe==="history"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:(0,e.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,e.jsx)(Ze.Z,{className:"w-4 h-4"}),(0,e.jsx)("span",{children:"\u5BF9\u6218\u8BB0\u5F55"})]})})]}),h==="online"&&Oe==="chat"&&(0,e.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,e.jsxs)("div",{className:"h-[500px] overflow-y-auto mb-4 space-y-4 px-2",style:{height:"500px"},children:[At.map(function(r){return(0,e.jsx)("div",{className:"flex ".concat(n!=null&&n.id&&String(r.sender.id)===String(n.id)?"justify-end":"justify-start"),children:(0,e.jsxs)("div",{className:"max-w-[85%] ".concat(n!=null&&n.id&&String(r.sender.id)===String(n.id)?"order-2":"order-1"),children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-1.5 ".concat(n!=null&&n.id&&String(r.sender.id)===String(n.id)?"justify-end":"justify-start"),children:[(0,e.jsx)("span",{className:"text-sm text-gray-800 font-medium",children:r.sender.name}),(0,e.jsx)("span",{className:"text-xs text-gray-400",children:new Date(r.timestamp).toLocaleTimeString()})]}),(0,e.jsx)("div",{className:"rounded-2xl px-4 py-2.5 ".concat(n!=null&&n.id&&String(r.sender.id)===String(n.id)?"bg-blue-50 text-gray-800 rounded-br-none border border-blue-100":"bg-gray-50 text-gray-800 rounded-bl-none border border-gray-100"),children:r.content})]})},r.id)}),(0,e.jsx)("div",{ref:Zt})]}),(0,e.jsxs)("div",{className:"flex gap-3 mt-auto pt-4 pb-4 border-t",children:[(0,e.jsx)(et.Z.TextArea,{value:Ke,onChange:function(t){return Le(t.target.value)},onKeyDown:function(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),Jt())},placeholder:"\u8F93\u5165\u6D88\u606F...",autoSize:{minRows:1,maxRows:4},className:"flex-1"}),(0,e.jsx)(He.ZP,{type:"primary",onClick:Jt,className:"px-6",children:"\u53D1\u9001"})]})]}),(h==="single"||h==="online"&&Oe==="history")&&(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:ee.length===0?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[(0,e.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-50 flex items-center justify-center mb-3",children:(0,e.jsx)(Ze.Z,{className:"w-8 h-8"})}),(0,e.jsx)("p",{children:"\u6682\u65E0\u843D\u5B50"})]}):(0,e.jsx)("div",{className:"space-y-2",children:ee.map(function(r,t){return(0,e.jsx)("div",{className:"p-3 rounded-lg cursor-pointer transition-all duration-200 ".concat(t===ee.length-1?"bg-blue-50 border border-blue-100 shadow-sm":"hover:bg-gray-50 border border-transparent hover:border-gray-100"),onClick:function(){},children:(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("div",{className:"w-5 h-5 rounded-full ".concat(r.player==="black"?"bg-gray-900":"bg-white border-2 border-gray-900")}),(0,e.jsx)("span",{className:"font-medium text-gray-800",children:aa(r)})]})},t)})})})]})})]})}),Dn&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 max-w-md w-full",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u91CD\u65B0\u5F00\u59CB"}),(0,e.jsx)("button",{onClick:function(){return _e(!1)},className:"text-gray-400 hover:text-gray-600",children:(0,e.jsx)(qe.Z,{className:"w-5 h-5"})})]}),(0,e.jsx)("p",{className:"text-gray-600 mb-6",children:"\u8BF7\u9009\u62E9\u91CD\u65B0\u5F00\u59CB\u7684\u65B9\u5F0F\uFF1A"}),(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsxs)("button",{type:"button",onClick:ta,className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[(0,e.jsx)("div",{className:"w-4 h-4 rounded-full ".concat(j==="black"?"bg-gray-900":"bg-white border-2 border-gray-900")}),(0,e.jsxs)("span",{className:"font-medium",children:["\u7EE7\u7EED",j==="black"?"\u6267\u9ED1\u5148\u624B":"\u6267\u767D\u540E\u624B"]})]}),(0,e.jsxs)("button",{type:"button",onClick:ea,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors flex items-center justify-center gap-2",children:[(0,e.jsx)("div",{className:"w-4 h-4 rounded-full ".concat(j==="black"?"bg-white border-2 border-gray-900":"bg-gray-900")}),(0,e.jsxs)("span",{className:"font-medium text-gray-800",children:["\u6539\u4E3A",j==="black"?"\u6267\u767D\u540E\u624B":"\u6267\u9ED1\u5148\u624B"]})]}),(0,e.jsx)("button",{type:"button",onClick:function(){return _e(!1)},className:"w-full px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",children:"\u53D6\u6D88"})]})]})}),Pn&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 max-w-md w-full",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u6E38\u620F\u7ED3\u675F"}),(0,e.jsx)("button",{onClick:function(){return Ee(!1)},className:"text-gray-400 hover:text-gray-600",children:(0,e.jsx)(qe.Z,{className:"w-5 h-5"})})]}),(0,e.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-6",children:[(0,e.jsx)(Ye.Z,{className:"w-8 h-8 text-yellow-600"}),(0,e.jsx)("span",{className:"text-lg font-medium text-gray-800",children:Z===j?"\u606D\u559C\u4F60\u8D62\u4E86\uFF01":"\u5BF9\u624B\u5C0F\u80DC\uFF0C\u518D\u63A5\u518D\u5389"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsx)("button",{type:"button",onClick:Xt,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors flex items-center justify-center gap-2",children:(0,e.jsx)("span",{className:"font-medium text-gray-800",children:"\u9000\u51FA\u623F\u95F4"})})})]})}),(0,e.jsx)(tt.Z,{title:"\u5BF9\u624B\u53EF\u80FD\u5DF2\u79BB\u5F00",open:Wn,onOk:function(){return Kt(!0)},onCancel:function(){return Kt(!1)},okText:"\u9000\u51FA\u623F\u95F4",cancelText:"\u7EE7\u7EED\u7B49\u5F85",children:(0,e.jsx)("p",{children:"\u5BF9\u624B\u5DF2\u7ECF\u8D85\u8FC730\u79D2\u6CA1\u6709\u4E0B\u5B50\uFF0C\u662F\u5426\u9000\u51FA\u623F\u95F4\uFF1F"})}),(0,e.jsx)(tt.Z,{title:"\u8BF7\u4E0B\u5B50",open:Hn,onOk:Vt,onCancel:Vt,okText:"\u6536\u5230\u9A6C\u4E0A\u4E0B",children:(0,e.jsx)("p",{children:"\u60A8\u5DF2\u7ECF\u8D85\u8FC730\u79D2\u6CA1\u6709\u4E0B\u5B50\uFF0C\u8BF7\u5C3D\u5FEB\u4E0B\u5B50\uFF01"})})]}):(0,e.jsx)("div",{className:"min-h-screen bg-gradient-to-br  to-indigo-50 flex items-center justify-center p-4",children:(0,e.jsxs)("div",{className:"bg-white p-12 rounded-2xl shadow-xl max-w-lg w-full text-center",children:[(0,e.jsx)("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"\u4E94\u5B50\u68CB Gomoku"}),(0,e.jsx)("p",{className:"text-gray-600 mb-12",children:"\u6311\u6218AI\uFF0C\u5C55\u73B0\u4F60\u7684\u68CB\u827A"}),(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)("h2",{className:"text-xl font-medium mb-4",children:"\u9009\u62E9\u6E38\u620F\u6A21\u5F0F"}),(0,e.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,e.jsxs)("button",{type:"button",className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",onClick:function(){return se("single")},children:[(0,e.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,e.jsx)("div",{style:{backgroundColor:h==="single"?"rgba(172,229,178,0.95)":"white",color:"white"},className:"w-5 h-5 rounded-full border-2 border-gray-800"}),(0,e.jsx)("span",{className:"font-medium text-gray-800",children:"\u5355\u4EBA VS AI"})]}),(0,e.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"Local Game"})]}),(0,e.jsxs)("button",{type:"button",onClick:function(){return se("online")},className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,e.jsx)("div",{style:{backgroundColor:h==="online"?"rgba(172,229,178,0.95)":"white",color:"white"},className:"w-5 h-5 rounded-full border-2 border-gray-800"}),(0,e.jsx)("span",{className:"font-medium text-gray-800",children:"\u8054\u673A\u5BF9\u6218"})]}),(0,e.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:" Online Game"})]})]})]}),vt,h==="online"&&(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)(et.Z,{type:"text",placeholder:"\u8F93\u5165\u623F\u95F4\u53F7\uFF08\u7559\u7A7A\u521B\u5EFA\u65B0\u623F\u95F4\uFF09",value:X,onChange:function(t){return Ne(t.target.value)},className:"border p-2 rounded-lg mb-4"}),(0,e.jsx)(He.ZP,{onClick:function(){X?z.o.send({type:2,userId:-1,data:{type:"joinRoom",content:X}}):z.o.send({type:2,userId:-1,data:{type:"createChessRoom",content:JSON.stringify({gameType:"normal"})}})},children:X?"\u52A0\u5165\u623F\u95F4":"\u521B\u5EFA\u623F\u95F4"})]}),h==="single"&&(0,e.jsxs)("div",{children:[(0,e.jsx)("h2",{className:"text-xl font-medium mb-8 text-gray-800",children:"\u9009\u62E9\u60A8\u7684\u6267\u5B50\u989C\u8272"}),(0,e.jsxs)("div",{className:"flex gap-6 justify-center",children:[(0,e.jsxs)("button",{type:"button",onClick:function(){return Gt("black")},className:"group px-8 py-4 bg-gray-900 text-white rounded-xl hover:bg-gray-800 transition-all duration-200 transform hover:scale-105",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,e.jsx)("div",{className:"w-5 h-5 rounded-full bg-black border-2 border-gray-700"}),(0,e.jsx)("span",{className:"font-medium",children:"\u6267\u9ED1\u5148\u624B"})]}),(0,e.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-300",children:"First Move"})]}),(0,e.jsxs)("button",{type:"button",onClick:function(){return Gt("white")},className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,e.jsx)("div",{className:"w-5 h-5 rounded-full bg-white border-2 border-gray-800"}),(0,e.jsx)("span",{className:"font-medium text-gray-800",children:"\u6267\u767D\u540E\u624B"})]}),(0,e.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"Second Move"})]})]})]})]})})}var vn=mn},86492:function(y,m,a){a.d(m,{o:function(){return ve}});var f=a(95111),W=a.n(f),O=a(7790),Q=a.n(O),we=a(43352),I=a.n(we),J=a(11719),o=a(68872),l=a(25092),e=function(){function H(){var P=this;W()(this,H),I()(this,"ws",null),I()(this,"reconnectAttempts",0),I()(this,"maxReconnectAttempts",5),I()(this,"reconnectTimeout",null),I()(this,"messageHandlers",new Map),I()(this,"isManuallyClosed",!1),I()(this,"notificationInterval",null),I()(this,"isWindowFocused",!0),I()(this,"handleWindowFocus",function(){P.isWindowFocused=!0,P.notificationInterval&&((0,l.I0)(P.notificationInterval),P.notificationInterval=null)}),I()(this,"handleWindowBlur",function(){P.isWindowFocused=!1}),this.addMessageHandler("error",function(w){o.ZP.error(w.data||"\u53D1\u751F\u9519\u8BEF")}),window.addEventListener("focus",this.handleWindowFocus),window.addEventListener("blur",this.handleWindowBlur)}return Q()(H,[{key:"isConnected",value:function(){var w;return((w=this.ws)===null||w===void 0?void 0:w.readyState)===WebSocket.OPEN}},{key:"connect",value:function(w){var U,i=this;this.isManuallyClosed||((U=this.ws)===null||U===void 0?void 0:U.readyState)!==WebSocket.OPEN&&(this.ws=new WebSocket(J.QF+w),this.ws.onopen=function(){var g;if(console.log("WebSocket\u8FDE\u63A5\u6210\u529F"),i.reconnectAttempts=0,((g=i.ws)===null||g===void 0?void 0:g.readyState)===WebSocket.OPEN){var $;($=i.ws)===null||$===void 0||$.send(JSON.stringify({type:1}))}else o.ZP.error("WebSocket\u8FDE\u63A5\u5931\u8D25")},this.ws.onclose=function(){if(console.log("WebSocket\u8FDE\u63A5\u5173\u95ED"),i.ws=null,!i.isManuallyClosed&&i.reconnectAttempts<i.maxReconnectAttempts){var g=Math.min(1e3*Math.pow(2,i.reconnectAttempts),1e4);i.reconnectTimeout=setTimeout(function(){i.reconnectAttempts++,i.connect(w)},g)}},this.ws.onmessage=function(g){try{var $=JSON.parse(g.data),ne=i.messageHandlers.get($.type)||[];if(ne.forEach(function(xe){return xe($)}),$.type==="chat"&&!i.isWindowFocused){i.notificationInterval&&(0,l.I0)(i.notificationInterval);var Be=(0,l.pM)($.data.content||"\u65B0\u6D88\u606F");Be&&(i.notificationInterval=Be)}}catch(xe){console.error("\u5904\u7406WebSocket\u6D88\u606F\u5931\u8D25:",xe)}},this.ws.onerror=function(g){console.error("WebSocket\u9519\u8BEF:",g),o.ZP.error("\u8FDE\u63A5\u53D1\u751F\u9519\u8BEF")},setInterval(function(){var g;((g=i.ws)===null||g===void 0?void 0:g.readyState)===WebSocket.OPEN&&i.ws.send(JSON.stringify({type:4}))},25e3))}},{key:"disconnect",value:function(){this.isManuallyClosed=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null),this.notificationInterval&&((0,l.I0)(this.notificationInterval),this.notificationInterval=null),window.removeEventListener("focus",this.handleWindowFocus),window.removeEventListener("blur",this.handleWindowBlur)}},{key:"send",value:function(w){var U;((U=this.ws)===null||U===void 0?void 0:U.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(w)):o.ZP.error("WebSocket\u8FDE\u63A5\u5DF2\u65AD\u5F00")}},{key:"addMessageHandler",value:function(w,U){var i;this.messageHandlers.has(w)||this.messageHandlers.set(w,[]),(i=this.messageHandlers.get(w))===null||i===void 0||i.push(U)}},{key:"removeMessageHandler",value:function(w,U){var i=this.messageHandlers.get(w);if(i){var g=i.indexOf(U);g!==-1&&i.splice(g,1)}}},{key:"clearMessageHandlers",value:function(){var w=this.messageHandlers.get("error")||[];this.messageHandlers.clear(),this.messageHandlers.set("error",w)}}],[{key:"getInstance",value:function(){return H.instance||(H.instance=new H),H.instance}}]),H}();I()(e,"instance",void 0);var ve=e.getInstance()}}]);
}());