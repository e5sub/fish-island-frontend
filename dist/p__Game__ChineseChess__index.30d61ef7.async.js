!(function(){"use strict";var mt=Object.defineProperty,yt=Object.defineProperties;var pt=Object.getOwnPropertyDescriptors;var Ur=Object.getOwnPropertySymbols;var ia=Object.prototype.hasOwnProperty,ua=Object.prototype.propertyIsEnumerable;var oa=(se,V,C)=>V in se?mt(se,V,{enumerable:!0,configurable:!0,writable:!0,value:C}):se[V]=C,$r=(se,V)=>{for(var C in V||(V={}))ia.call(V,C)&&oa(se,C,V[C]);if(Ur)for(var C of Ur(V))ua.call(V,C)&&oa(se,C,V[C]);return se},ca=(se,V)=>yt(se,pt(V));var sn=(se,V)=>{var C={};for(var Q in se)ia.call(se,Q)&&V.indexOf(Q)<0&&(C[Q]=se[Q]);if(se!=null&&Ur)for(var Q of Ur(se))V.indexOf(Q)<0&&ua.call(se,Q)&&(C[Q]=se[Q]);return C};(self.webpackChunkreact_frontend_init=self.webpackChunkreact_frontend_init||[]).push([[9769],{98583:function(se,V,C){C.r(V),C.d(V,{default:function(){return Ba}});var Q=C(39250),pe=C.n(Q),xe=C(56840),lr=C.n(xe),wr=C(64581),fe=C.n(wr),We=C(84136),B=C.n(We),Ie=C(90785),I=C.n(Ie),j=C(67294),De=null,be=null,ie=null,Ae=null,G={red:{general:"\u5E05",advisor:"\u4ED5",elephant:"\u76F8",horse:"\u9A6C",chariot:"\u8F66",cannon:"\u70AE",soldier:"\u5175"},black:{general:"\u5C06",advisor:"\u58EB",elephant:"\u8C61",horse:"\u9A6C",chariot:"\u8F66",cannon:"\u70AE",soldier:"\u5352"}},n=C(85893);function _e(t){var e=t.piece,r=t.size,u=t.isSelected,a=u===void 0?!1:u,f=t.isStartPosition,i=f===void 0?!1:f,l=e.type,g=e.player,y=e.isHidden;return y?(0,n.jsx)("div",{className:"relative flex items-center justify-center rounded-full transition-all duration-300 ".concat(a?"ring-2 ring-blue-500 ring-offset-2":""),style:{width:r,height:r,backgroundColor:"#e5e7eb",border:"2px solid #9ca3af",boxShadow:a?"0 0 0 2px rgba(59, 130, 246, 0.5)":"none"},children:(0,n.jsx)("span",{className:"text-gray-600 font-medium",children:"\u6697"})}):(0,n.jsx)("div",{className:"relative flex items-center justify-center rounded-full transition-all duration-300 ".concat(a?"ring-2 ring-blue-500 ring-offset-2":""),style:{width:r,height:r,backgroundColor:g==="red"?"#fee2e2":"#e5e7eb",border:"2px solid ".concat(g==="red"?"#dc2626":"#000000"),boxShadow:a?"0 0 0 2px rgba(59, 130, 246, 0.5)":"none"},children:(0,n.jsx)("span",{className:"text-lg font-bold",style:{color:g==="red"?"#dc2626":"#000000"},children:G[g][l]})})}var br=C(94127),Cr=C.n(br),jr=["isHidden","originalPosition"],_=9,ee=10,ze=!1;function da(){return Array(ee).fill(null).map(function(){return Array(_).fill(null)})}function Ee(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"normal",e=da();if(t==="normal")return U(e,"chariot","red",9,0),U(e,"horse","red",9,1),U(e,"elephant","red",9,2),U(e,"advisor","red",9,3),U(e,"general","red",9,4),U(e,"advisor","red",9,5),U(e,"elephant","red",9,6),U(e,"horse","red",9,7),U(e,"chariot","red",9,8),U(e,"cannon","red",7,1),U(e,"cannon","red",7,7),U(e,"soldier","red",6,0),U(e,"soldier","red",6,2),U(e,"soldier","red",6,4),U(e,"soldier","red",6,6),U(e,"soldier","red",6,8),U(e,"chariot","black",0,0),U(e,"horse","black",0,1),U(e,"elephant","black",0,2),U(e,"advisor","black",0,3),U(e,"general","black",0,4),U(e,"advisor","black",0,5),U(e,"elephant","black",0,6),U(e,"horse","black",0,7),U(e,"chariot","black",0,8),U(e,"cannon","black",2,1),U(e,"cannon","black",2,7),U(e,"soldier","black",3,0),U(e,"soldier","black",3,2),U(e,"soldier","black",3,4),U(e,"soldier","black",3,6),U(e,"soldier","black",3,8),e;U(e,"general","red",9,4),U(e,"general","black",0,4);for(var r=["chariot","chariot","horse","horse","elephant","elephant","advisor","advisor","cannon","cannon","soldier","soldier","soldier","soldier","soldier"],u=r.map(function(W,P){return{type:W,player:"red",id:"red-".concat(W,"-").concat(P)}}),a=r.map(function(W,P){return{type:W,player:"black",id:"black-".concat(W,"-").concat(P)}}),f=u.length-1;f>0;f--){var i=Math.floor(Math.random()*(f+1)),l=[u[i],u[f]];u[f]=l[0],u[i]=l[1]}for(var g=a.length-1;g>0;g--){var y=Math.floor(Math.random()*(g+1)),p=[a[y],a[g]];a[g]=p[0],a[y]=p[1]}for(var c=0,x=0;x<9;x++)x!==4&&(e[9][x]=B()(B()({},u[c++]),{},{isHidden:!0,originalPosition:{row:9,col:x}}));e[7][1]=B()(B()({},u[c++]),{},{isHidden:!0,originalPosition:{row:7,col:1}}),e[7][7]=B()(B()({},u[c++]),{},{isHidden:!0,originalPosition:{row:7,col:7}});for(var k=0;k<9;k+=2)e[6][k]=B()(B()({},u[c++]),{},{isHidden:!0,originalPosition:{row:6,col:k}});for(var F=0,M=0;M<9;M++)M!==4&&(e[0][M]=B()(B()({},a[F++]),{},{isHidden:!0,originalPosition:{row:0,col:M}}));e[2][1]=B()(B()({},a[F++]),{},{isHidden:!0,originalPosition:{row:2,col:1}}),e[2][7]=B()(B()({},a[F++]),{},{isHidden:!0,originalPosition:{row:2,col:7}});for(var H=0;H<9;H+=2)e[3][H]=B()(B()({},a[F++]),{},{isHidden:!0,originalPosition:{row:3,col:H}});return e}function U(t,e,r,u,a){t[u][a]={type:e,player:r,id:"".concat(r,"-").concat(e,"-").concat(u,"-").concat(a)}}function fa(t){return t.map(function(e){return fe()(e)})}function ar(t){return t.row>=0&&t.row<ee&&t.col>=0&&t.col<_}function or(t,e){var r=t.row,u=t.col,a=u>=3&&u<=5,f=e==="red"?r>=7&&r<=9:r>=0&&r<=2;return a&&f}function Ir(t,e,r,u,a){var f,i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(((f=t[r.row][r.col])===null||f===void 0?void 0:f.player)===a)return!1;var l=t[e.row][e.col],g=l?He(l,e):u;switch(g){case"general":return on(t,e,r,a);case"advisor":return un(t,e,r,a,i);case"elephant":return cn(t,e,r,a,i);case"horse":return dn(t,e,r);case"chariot":return fn(t,e,r);case"cannon":return vn(t,e,r);case"soldier":return hn(t,e,r,a);default:return!1}}function ln(t,e,r){var u,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,f=t[e.row][e.col];if(!f||((u=t[r.row][r.col])===null||u===void 0?void 0:u.player)===f.player)return!1;var i=He(f,e);switch(i){case"general":return on(t,e,r,f.player);case"advisor":return un(t,e,r,f.player,a);case"elephant":return cn(t,e,r,f.player,a);case"horse":return dn(t,e,r);case"chariot":return fn(t,e,r);case"cannon":return vn(t,e,r);case"soldier":return hn(t,e,r,f.player);default:return!1}}function on(t,e,r,u){if(!or(r,u))return!1;var a=Math.abs(r.row-e.row),f=Math.abs(r.col-e.col),i=a===1&&f===0||a===0&&f===1;if(!i){var l=u==="red"?"black":"red",g=t[r.row][r.col];if(g&&g.player===l&&g.type==="general"&&r.col===e.col){for(var y=!1,p=Math.min(e.row,r.row)+1,c=Math.max(e.row,r.row),x=p;x<c;x++)if(t[x][e.col]!==null){y=!0;break}if(!y)return!0}}return i}function un(t,e,r,u){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(!a&&!or(r,u))return!1;var f=Math.abs(r.row-e.row),i=Math.abs(r.col-e.col);return f===1&&i===1}function cn(t,e,r,u){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(!a&&(u==="red"&&r.row<5||u==="black"&&r.row>4))return!1;var f=Math.abs(r.row-e.row),i=Math.abs(r.col-e.col);if(f!==2||i!==2)return!1;var l=Math.floor((e.row+r.row)/2),g=Math.floor((e.col+r.col)/2);return t[l][g]===null}function dn(t,e,r){var u=Math.abs(r.row-e.row),a=Math.abs(r.col-e.col);if(!(u===1&&a===2||u===2&&a===1))return!1;if(u===2){var f=e.row+(r.row>e.row?1:-1),i=e.col;if(t[f][i]!==null)return!1}else{var l=e.row,g=e.col+(r.col>e.col?1:-1);if(t[l][g]!==null)return!1}return!0}function fn(t,e,r){var u=Math.abs(r.row-e.row),a=Math.abs(r.col-e.col);if(u>0&&a>0)return!1;if(u>0)for(var f=r.row>e.row?1:-1,i=e.row+f;i!==r.row;){if(t[i][e.col]!==null)return!1;i+=f}else if(a>0)for(var l=r.col>e.col?1:-1,g=e.col+l;g!==r.col;){if(t[e.row][g]!==null)return!1;g+=l}return!0}function vn(t,e,r){var u=Math.abs(r.row-e.row),a=Math.abs(r.col-e.col);if(u>0&&a>0)return!1;var f=0;if(u>0)for(var i=r.row>e.row?1:-1,l=e.row+i;l!==r.row;)t[l][e.col]!==null&&f++,l+=i;else if(a>0)for(var g=r.col>e.col?1:-1,y=e.col+g;y!==r.col;)t[e.row][y]!==null&&f++,y+=g;var p=t[r.row][r.col];return p===null?f===0:f===1}function hn(t,e,r,u){var a=r.row-e.row,f=Math.abs(a),i=Math.abs(r.col-e.col);return u==="red"?a>0?!1:e.row>4?a===-1&&i===0:f===1&&i===0||a===0&&i===1:a<0?!1:e.row<5?a===1&&i===0:f===1&&i===0||a===0&&i===1}function er(t,e){for(var r=0;r<ee;r++)for(var u=0;u<_;u++){var a=t[r][u];if(a&&a.type==="general"&&a.player===e)return{row:r,col:u}}return null}function Le(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"normal",a=ze||r,f=er(t,e);if(!f)return{inCheck:!1,checkedBy:null};for(var i=e==="red"?"black":"red",l=[],g=0;g<ee;g++)for(var y=0;y<_;y++){var p=t[g][y];if(p&&p.player===i){var c={row:g,col:y};ur(t,c,f,u)&&(l.push(p),a||console.log("".concat(e,"\u65B9\u5C06/\u5E05\u88AB").concat(i,"\u65B9").concat(p.type,"\u5C06\u519B")))}}var x=er(t,i);if(x&&f.col===x.col){for(var k=!1,F=Math.min(f.row,x.row)+1,M=Math.max(f.row,x.row),H=F;H<M;H++)if(t[H][f.col]!==null){k=!0;break}if(!k){var W=t[x.row][x.col];W&&(l.some(function(P){return P.id===W.id})||(l.push(W),a||console.log("\u5C06\u5E05\u5BF9\u9762: ".concat(e,"\u65B9\u5C06/\u5E05\u88AB").concat(i,"\u65B9\u5C06/\u5E05\u7167\u9762\uFF0C\u6CA1\u6709\u4E2D\u95F4\u5B50\u963B\u6321"))))}}return{inCheck:l.length>0,checkedBy:l.length>0?l:null}}function ir(t,e,r,u){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,f=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"normal",i=ze||a,l=Je(t,e,r,f),g=Le(l,u,i,f);return!g.inCheck}function rr(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"normal",a=ze||r,f=Le(t,e,a,u);if(!f.inCheck)return!1;for(var i=0;i<ee;i++)for(var l=0;l<_;l++){var g=t[i][l];if(g&&g.player===e){var y={row:i,col:l};if(u==="hidden")if(g.isHidden)for(var p=g.originalPosition||y,c=vr(p),x=Nr(t,y,c,e,!0,u),k=0,F=x;k<F.length;k++){var M=F[k];if(pn(t,y,M,g)&&ir(t,y,M,e,a,u))return!1}else for(var H=He(g,y),W=Nr(t,y,H,e,!0,u),P=0,D=W;P<D.length;P++){var re=D[P];if(ur(t,y,re,u)&&ir(t,y,re,e,a,u))return!1}else for(var ve=He(g,y),L=Nr(t,y,ve,e,!0,u),$=0,ne=L;$<ne.length;$++){var ae=ne[$];if(ur(t,y,ae,u)&&ir(t,y,ae,e,a,u))return!1}}}return!0}function Je(t,e,r){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"normal",a=fa(t),f=a[e.row][e.col];if(!f)return a;if(u==="hidden"&&f.isHidden){var i=f,l=i.isHidden,g=i.originalPosition,y=lr()(i,jr),p=B()({},y);a[r.row][r.col]=p}else a[r.row][r.col]=f;return a[e.row][e.col]=null,a}function kr(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"normal",u=ze;ze=!0;try{for(var a=Date.now(),f=[],i=e==="red"?"black":"red",l=Le(t,e,!0,r),g=0,y=0;y<ee;y++)for(var p=0;p<_;p++){var c=t[y][p];if(c&&c.player===e){var x={row:y,col:p},k=void 0;r==="hidden"&&c.isHidden?k=vr(c.originalPosition||x):k=c.type;for(var F=Nr(t,x,k,e,!0,r),M=0,H=F;M<H.length;M++){var W=H[M];if(ur(t,x,W,r)&&ir(t,x,W,e,!0,r)){g++;var P=Je(t,x,W,r);if(va(P,W,e,i,r))return console.log("AI\u627E\u5230\u4E86\u7ACB\u5373\u83B7\u80DC\u7684\u8D70\u6CD5: ".concat(k," (").concat(x.row,",").concat(x.col,")->(").concat(W.row,",").concat(W.col,")")),{from:x,to:W};var D=Kr(P,3,!1,-1/0,1/0,e,i,r);if(f.push({from:x,to:W,score:D}),g>150&&Date.now()-a>1500){console.log("AI\u641C\u7D22\u63D0\u524D\u505C\u6B62: \u5DF2\u68C0\u67E5".concat(g,"\u4E2A\u8D70\u6CD5\uFF0C\u8017\u65F6").concat(Date.now()-a,"ms"));break}}}}}f.sort(function($,ne){return ne.score-$.score});var re=Date.now(),ve=re-a;if(f.length===0)return console.log("AI\u6CA1\u6709\u627E\u5230\u4EFB\u4F55\u53EF\u80FD\u7684\u79FB\u52A8"),{from:{row:0,col:0},to:{row:0,col:0}};var L=f[0];return console.log("AI\u9009\u62E9\u4E86\u6700\u4F73\u79FB\u52A8: ".concat(L.from.row,",").concat(L.from.col,"->").concat(L.to.row,",").concat(L.to.col,"\uFF0C\u5206\u6570: ").concat(L.score,"\uFF0C\u8017\u65F6: ").concat(ve,"ms")),{from:L.from,to:L.to}}finally{ze=u}}function va(t,e,r,u){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"normal",f=t[e.row][e.col];return f&&f.type==="general"&&f.player===u?!0:rr(t,u,!0,a)}function Kr(t,e,r,u,a,f,i,l){if(e===0)return Dr(t,f,i,l);if(rr(t,i,!0,l))return 1e5+e*1e3;if(rr(t,f,!0,l))return-1e5-e*1e3;for(var g=[],y=r?f:i,p=0;p<ee;p++)for(var c=0;c<_;c++){var x=t[p][c];if(x&&x.player===y){var k={row:p,col:c},F=void 0;l==="hidden"&&x.isHidden?F=vr(x.originalPosition||k):F=x.type;for(var M=Nr(t,k,F,y,!0,l),H=0,W=M;H<W.length;H++){var P=W[H];if(ur(t,k,P,l)){var D=Je(t,k,P,l),re=ha(D,x,P,f,i,r,l);g.push({fromPos:k,toPos:P,score:re})}}}}g.sort(function(le,N){return r?N.score-le.score:le.score-N.score});var ve=g.slice(0,Math.min(15,g.length));if(r){var L=-1/0,$=Cr()(ve),ne;try{for($.s();!(ne=$.n()).done;){var ae=ne.value;if(ir(t,ae.fromPos,ae.toPos,f,!0,l)){var K=Je(t,ae.fromPos,ae.toPos,l),A=Kr(K,e-1,!1,u,a,f,i,l);if(L=Math.max(L,A),u=Math.max(u,A),a<=u)break}}}catch(le){$.e(le)}finally{$.f()}return L===-1/0?Dr(t,f,i,l):L}else{var o=1/0,v=Cr()(ve),d;try{for(v.s();!(d=v.n()).done;){var Z=d.value;if(ir(t,Z.fromPos,Z.toPos,i,!0,l)){var ge=Je(t,Z.fromPos,Z.toPos,l),Ze=Kr(ge,e-1,!0,u,a,f,i,l);if(o=Math.min(o,Ze),a=Math.min(a,Ze),a<=u)break}}}catch(le){v.e(le)}finally{v.f()}return o===1/0?Dr(t,f,i,l):o}}function ha(t,e,r,u,a,f){var i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"normal",l={general:1e4,advisor:200,elephant:250,horse:550,chariot:950,cannon:500,soldier:120},g=0;if(i==="hidden"&&e.isHidden){g+=300;var y=u==="red"&&r.row<5||u==="black"&&r.row>4;y&&(g+=200);var p=ga(t,r),c=p.filter(function($){return $&&$.player===u&&!$.isHidden});g+=c.length*100;var x=p.filter(function($){return $&&$.player===a&&!$.isHidden});g+=x.length*150;var k=ma(t,r,a);return k&&(g+=250),f?g:-g}var F=t[r.row][r.col],M=F?He(F,{row:r.row,col:r.col}):null;if(F&&(g+=l[M]*1.2,M==="general"))return f?9999:-9999;var H=He(e,r);if(H==="soldier"){var W=e.player==="red"&&r.row<5||e.player==="black"&&r.row>4;W&&(g+=70)}if(["chariot","horse","cannon"].includes(H)){var P=8-Math.abs(r.col-4)-Math.abs(r.row-4.5);g+=P*8,r.col===4&&(g+=20)}if(H==="horse"){var D=6-(Math.abs(r.col-4)+Math.abs(r.row-4.5))/2;g+=D*10}else if(H==="chariot")g+=Gr(t,r)*15;else if(H==="cannon"){for(var re=0,ve=0;ve<ee;ve++)t[ve][r.col]!==null&&re++;for(var L=0;L<_;L++)t[r.row][L]!==null&&re++;g+=re*5}return gn(t,r,e.player,i)&&(g-=l[H]/2),f?g:-g}function ga(t,e){for(var r=[],u=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],a=0,f=u;a<f.length;a++){var i=I()(f[a],2),l=i[0],g=i[1],y=e.row+l,p=e.col+g;y>=0&&y<ee&&p>=0&&p<_&&r.push(t[y][p])}return r}function ma(t,e,r){for(var u=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],a=0,f=u;a<f.length;a++){var i=I()(f[a],2),l=i[0],g=i[1],y=e.row+l,p=e.col+g;if(y>=0&&y<ee&&p>=0&&p<_){var c=t[y][p];if(c&&c.player===r&&!c.isHidden&&["chariot","horse","cannon","general"].includes(c.type))return!0}}return!1}function Nr(t,e,r,u){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,f=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"normal",i=t[e.row][e.col];if(i&&i.isHidden){for(var l=[],g=0;g<ee;g++)for(var y=0;y<_;y++){var p={row:g,col:y};pn(t,e,p,i)&&l.push(p)}return l}var c=[],x=e.row,k=e.col,F=i?He(i,e):r;switch(F){case"general":var M=[[0,1],[1,0],[0,-1],[-1,0]];M.forEach(function(le){var N=I()(le,2),ue=N[0],Te=N[1],ce=x+ue,Ce=k+Te;ar({row:ce,col:Ce})&&or({row:ce,col:Ce},u)&&c.push({row:ce,col:Ce})});var H=u==="red"?"black":"red",W=er(t,H);if(W&&W.col===k){for(var P=!1,D=Math.min(x,W.row),re=Math.max(x,W.row),ve=D+1;ve<re;ve++)if(t[ve][k]!==null){P=!0;break}P||c.push(W)}break;case"advisor":[[1,1],[1,-1],[-1,1],[-1,-1]].forEach(function(le){var N=I()(le,2),ue=N[0],Te=N[1],ce=x+ue,Ce=k+Te;ar({row:ce,col:Ce})&&or({row:ce,col:Ce},u)&&c.push({row:ce,col:Ce})});break;case"elephant":[[2,2],[2,-2],[-2,2],[-2,-2]].forEach(function(le){var N=I()(le,2),ue=N[0],Te=N[1],ce=x+ue,Ce=k+Te,nr=u==="red"&&ce<5||u==="black"&&ce>4;if(ar({row:ce,col:Ce})&&!nr){var Ge=Math.floor((x+ce)/2),hr=Math.floor((k+Ce)/2);t[Ge][hr]===null&&c.push({row:ce,col:Ce})}});break;case"horse":[[1,2],[2,1],[2,-1],[1,-2],[-1,-2],[-2,-1],[-2,1],[-1,2]].forEach(function(le){var N=I()(le,2),ue=N[0],Te=N[1],ce=x+ue,Ce=k+Te;if(ar({row:ce,col:Ce})){var nr=x,Ge=k;Math.abs(ue)===1?Ge+=Math.sign(Te):nr+=Math.sign(ue),t[nr][Ge]===null&&c.push({row:ce,col:Ce})}});break;case"chariot":for(var L=k+1;L<_&&(c.push({row:x,col:L}),t[x][L]===null);L++);for(var $=k-1;$>=0&&(c.push({row:x,col:$}),t[x][$]===null);$--);for(var ne=x+1;ne<ee&&(c.push({row:ne,col:k}),t[ne][k]===null);ne++);for(var ae=x-1;ae>=0&&(c.push({row:ae,col:k}),t[ae][k]===null);ae--);break;case"cannon":for(var K=!1,A=k+1;A<_;A++)if(!K&&t[x][A]===null)c.push({row:x,col:A});else if(!K&&t[x][A]!==null)K=!0;else if(K&&t[x][A]!==null){c.push({row:x,col:A});break}K=!1;for(var o=k-1;o>=0;o--)if(!K&&t[x][o]===null)c.push({row:x,col:o});else if(!K&&t[x][o]!==null)K=!0;else if(K&&t[x][o]!==null){c.push({row:x,col:o});break}K=!1;for(var v=x+1;v<ee;v++)if(!K&&t[v][k]===null)c.push({row:v,col:k});else if(!K&&t[v][k]!==null)K=!0;else if(K&&t[v][k]!==null){c.push({row:v,col:k});break}K=!1;for(var d=x-1;d>=0;d--)if(!K&&t[d][k]===null)c.push({row:d,col:k});else if(!K&&t[d][k]!==null)K=!0;else if(K&&t[d][k]!==null){c.push({row:d,col:k});break}break;case"soldier":var Z=u==="red"?-1:1,ge=x+Z;ar({row:ge,col:k})&&c.push({row:ge,col:k});var Ze=u==="red"&&x<5||u==="black"&&x>4;Ze&&(k>0&&c.push({row:x,col:k-1}),k<_-1&&c.push({row:x,col:k+1}));break}return c.filter(function(le){var N=t[le.row][le.col],ue=i?He(i,e):r;return(N===null||N.player!==u)&&Ir(t,e,le,ue,u,f==="hidden"?!1:void 0)})}function gn(t,e,r){for(var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"normal",a=r==="red"?"black":"red",f=0;f<ee;f++)for(var i=0;i<_;i++){var l=t[f][i];if(l&&l.player===a){var g={row:f,col:i},y=He(l,g);if(Ir(t,g,e,y,a))return!0}}return!1}function ya(t,e,r){for(var u=0,a=r==="red"?"black":"red",f=0;f<ee;f++)for(var i=0;i<_;i++){var l=t[f][i];if(l&&l.player===a){var g=t[e.row][e.col];if(g){var y=He(g,e);Ir(t,e,{row:f,col:i},y,r)&&u++}}}return u}function Gr(t,e){for(var r=0,u=e.row,a=e.col,f=[{dr:-1,dc:0},{dr:1,dc:0},{dr:0,dc:-1},{dr:0,dc:1}],i=0,l=f;i<l.length;i++){for(var g=l[i],y=0,p=u+g.dr,c=a+g.dc;p>=0&&p<ee&&c>=0&&c<_&&t[p][c]===null;){y++;p+=g.dr,c+=g.dc}y>=2&&r++}return r}function xt(t,e,r,u,a){var f=Je(t,e,r),i=Le(f,a,!0);return i.inCheck}function mn(t,e,r){var u=0,a=t[e.row][e.col];if(!a)return 0;for(var f=He(a,e),i=0;i<ee;i++)for(var l=0;l<_;l++){var g=t[i][l];if(g&&g.player===r){var y=He(g,{row:i,col:l});if(["general","chariot","horse"].includes(y)){var p=Math.abs(e.row-i)+Math.abs(e.col-l);p<=2&&u++}}}return u}function wt(t,e,r,u,a){var f=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"normal",i=Je(t,e,r,f);return Dr(i,u,a,f)}function Dr(t,e,r){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"normal",a=0,f=Le(t,e,!0,u),i=Le(t,r,!0,u);if(rr(t,r,!0,u))return 1e5;if(rr(t,e,!0,u))return-1e5;for(var l={general:1e4,advisor:220,elephant:270,horse:600,chariot:1e3,cannon:550,soldier:130},g={chariot:[[14,14,12,18,16,18,12,14,14],[16,20,18,24,26,24,18,20,16],[12,12,12,18,18,18,12,12,12],[12,18,16,22,22,22,16,18,12],[12,14,12,18,18,18,12,14,12],[12,16,14,20,20,20,14,16,12],[6,10,8,14,14,14,8,10,6],[4,8,6,14,12,14,6,8,4],[8,4,8,16,8,16,8,4,8],[6,8,6,14,12,14,6,8,6]],horse:[[4,8,16,12,4,12,16,8,4],[4,10,28,16,8,16,28,10,4],[12,14,16,20,18,20,16,14,12],[8,24,18,24,20,24,18,24,8],[6,16,14,18,16,18,14,16,6],[4,12,16,14,12,14,16,12,4],[2,6,8,6,10,6,8,6,2],[4,2,8,8,4,8,8,2,4],[0,2,4,4,-2,4,4,2,0],[0,-4,0,0,0,0,0,-4,0]],soldier:[[0,3,6,9,12,9,6,3,0],[18,36,56,80,120,80,56,36,18],[14,26,42,60,80,60,42,26,14],[10,20,30,34,40,34,30,20,10],[6,12,18,18,20,18,18,12,6],[2,0,8,0,8,0,8,0,2],[0,0,-2,0,4,0,-2,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],cannon:[[6,4,0,-10,-12,-10,0,4,6],[2,2,0,-4,-14,-4,0,2,2],[2,2,0,-10,-8,-10,0,2,2],[0,0,-2,4,10,4,-2,0,0],[0,0,0,2,8,2,0,0,0],[-2,0,4,2,6,2,4,0,-2],[0,0,0,2,4,2,0,0,0],[4,0,8,6,10,6,8,0,4],[0,2,4,6,6,6,4,2,0],[0,0,2,6,6,6,2,0,0]],advisor:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,20,0,20,0,0,0],[0,0,0,0,23,0,0,0,0],[0,0,0,20,0,20,0,0,0]],elephant:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,20,0,0,0,20,0,0],[0,0,0,0,0,0,0,0,0],[18,0,0,0,25,0,0,0,18],[0,0,0,0,0,0,0,0,0],[0,0,20,0,0,0,20,0,0]],general:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,1,3,1,0,0,0],[0,0,0,2,8,2,0,0,0],[0,0,0,1,3,1,0,0,0]]},y=0;y<ee;y++)for(var p=0;p<_;p++){var c=t[y][p];if(c){var x=l[c.type],k=0;if(g[c.type]){var F=c.player==="red"?y:9-y,M=c.player==="red"?p:8-p;k=g[c.type][F][M]}var H=x+k;if(c.player===e){if(a+=H,c.type==="chariot"||c.type==="horse"||c.type==="cannon"){var W=Gr(t,{row:y,col:p})*15;a+=W;var P=ya(t,{row:y,col:p},e)*25;a+=P;var D=mn(t,{row:y,col:p},e)*10;a+=D}if(c.type==="soldier"){var re=e==="red"&&y<5||e==="black"&&y>4;re&&(a+=70,e==="red"?a+=(5-y)*15:a+=y*15);for(var ve=[p-1,p+1],L=0,$=ve;L<$.length;L++){var ne=$[L];if(ne>=0&&ne<_){var ae=t[y][ne];ae&&ae.type==="soldier"&&ae.player===e&&(a+=20)}}}(c.type==="advisor"||c.type==="elephant")&&or({row:y,col:p},e)&&(a+=30)}else if(a-=H,gn(t,{row:y,col:p},r,u)&&(a+=x/1.8),c.type==="chariot"||c.type==="horse"||c.type==="cannon"){var K=Gr(t,{row:y,col:p})*12;a-=K,mn(t,{row:y,col:p},r)===0&&(a+=40)}}}return i.inCheck&&(a+=350,i.checkedBy&&i.checkedBy.length>1&&(a+=150*i.checkedBy.length)),f.inCheck&&(a-=300,f.checkedBy&&f.checkedBy.length>1&&(a-=150*f.checkedBy.length)),a+=yn(t,e)*30,a-=yn(t,r)*25,a}function yn(t,e){for(var r=0,u=[],a=0;a<ee;a++)for(var f=0;f<_;f++){var i=t[a][f];i&&i.player===e&&(i.type==="chariot"||i.type==="horse"||i.type==="cannon")&&u.push({piece:i,pos:{row:a,col:f}})}for(var l=0;l<u.length;l++)for(var g=l+1;g<u.length;g++){var y=u[l],p=u[g],c=Math.abs(y.pos.row-p.pos.row)+Math.abs(y.pos.col-p.pos.col);c>=2&&c<=5&&(r++,(y.piece.type==="chariot"&&p.piece.type==="horse"||y.piece.type==="horse"&&p.piece.type==="chariot")&&(r+=2),(y.piece.type==="chariot"&&p.piece.type==="cannon"||y.piece.type==="cannon"&&p.piece.type==="chariot")&&(r+=1))}return r}function bt(t,e){var r=_objectSpread({},console),u=ze;try{return Object.keys(console).forEach(function(a){console[a]=function(){}}),ze=!0,kr(t,e)}finally{Object.keys(r).forEach(function(a){console[a]=r[a]}),ze=u}}function Ct(t,e,r,u){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,f=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return a?ur(t,e,r):ir(t,e,r,u,f)}function pn(t,e,r,u){var a=t[r.row][r.col];if(a&&a.player===u.player||!ar(r))return!1;var f=u.originalPosition||e,i=vr(f);switch(i){case"soldier":return u.player==="red"?e.row-r.row===1&&e.col===r.col:r.row-e.row===1&&e.col===r.col;case"cannon":if(e.row===r.row||e.col===r.col)if(a){var k=0;if(e.row===r.row)for(var F=Math.min(e.col,r.col),M=Math.max(e.col,r.col),H=F+1;H<M;H++)t[e.row][H]&&k++;else for(var W=Math.min(e.row,r.row),P=Math.max(e.row,r.row),D=W+1;D<P;D++)t[D][e.col]&&k++;return k===1}else{if(e.row===r.row){for(var l=Math.min(e.col,r.col),g=Math.max(e.col,r.col),y=l+1;y<g;y++)if(t[e.row][y])return!1}else for(var p=Math.min(e.row,r.row),c=Math.max(e.row,r.row),x=p+1;x<c;x++)if(t[x][e.col])return!1;return!0}return!1;case"chariot":if(e.row===r.row){for(var re=Math.min(e.col,r.col),ve=Math.max(e.col,r.col),L=re+1;L<ve;L++)if(t[e.row][L])return!1;return!0}else if(e.col===r.col){for(var $=Math.min(e.row,r.row),ne=Math.max(e.row,r.row),ae=$+1;ae<ne;ae++)if(t[ae][e.col])return!1;return!0}return!1;case"horse":var K=Math.abs(r.row-e.row),A=Math.abs(r.col-e.col);if(K===2&&A===1||K===1&&A===2){var o,v;return K===2?(o=e.row+(r.row>e.row?1:-1),v=e.col):(o=e.row,v=e.col+(r.col>e.col?1:-1)),!t[o][v]}return!1;case"elephant":if(Math.abs(r.row-e.row)===2&&Math.abs(r.col-e.col)===2){var d=(e.row+r.row)/2,Z=(e.col+r.col)/2;return!t[d][Z]}return!1;case"advisor":return or(r,u.player)?Math.abs(r.row-e.row)===1&&Math.abs(r.col-e.col)===1:!1;case"general":return or(r,u.player)?Math.abs(r.row-e.row)===1&&e.col===r.col||Math.abs(r.col-e.col)===1&&e.row===r.row:!1;default:return!1}}function vr(t){var e=t.row,r=t.col;if(e>=7){if(e===9){if(r===0||r===8)return"chariot";if(r===1||r===7)return"horse";if(r===2||r===6)return"elephant";if(r===3||r===5)return"advisor";if(r===4)return"general"}if(e===7&&(r===1||r===7))return"cannon";if(e===6&&(r===0||r===2||r===4||r===6||r===8))return"soldier"}if(e<=2){if(e===0){if(r===0||r===8)return"chariot";if(r===1||r===7)return"horse";if(r===2||r===6)return"elephant";if(r===3||r===5)return"advisor";if(r===4)return"general"}if(e===2&&(r===1||r===7))return"cannon";if(e===3&&(r===0||r===2||r===4||r===6||r===8))return"soldier"}return"soldier"}function ur(t,e,r){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"normal";if(!ar(e)||!ar(r))return!1;var a=t[e.row][e.col];if(!a)return!1;if(u==="hidden"){if(a.isHidden){var f=a.originalPosition||e,i=vr(f);return Ir(t,e,r,i,a.player,!1)}var l=He(a,e);return ln(t,e,r,l==="advisor"||l==="elephant")}var g=He(a,e);return ln(t,e,r,g==="advisor"||g==="elephant")}function He(t,e){if(t.isHidden){var r=t.originalPosition||e;return vr(r)}return t.type}var xn="#f0f7ff",pa="#000000";function xa(t){var e=t.board,r=t.onPieceSelect,u=t.onMoveSelect,a=t.selectedPosition,f=t.validMoves,i=t.lastMove,l=t.checkPosition,g=t.disabled,y=t.isFlipped,p=y===void 0?!1:y,c=(0,j.useRef)(null),x=(0,j.useState)(60),k=I()(x,2),F=k[0],M=k[1],H=(0,j.useState)(null),W=I()(H,2),P=W[0],D=W[1],re=(0,j.useRef)(null);(0,j.useEffect)(function(){var A=function(){var v;if(c.current){var d=((v=c.current.parentElement)===null||v===void 0?void 0:v.clientWidth)||600,Z=Math.min(d-60,700),ge=Math.floor(Z/(_+1))-2;M(Math.max(ge,50))}};return A(),window.addEventListener("resize",A),function(){return window.removeEventListener("resize",A)}},[]),(0,j.useEffect)(function(){if(re.current){var A=re.current,o=A.getContext("2d");if(o){D(o);var v=F*(_-1),d=F*(ee-1);A.width=v+F*2,A.height=d+F*2.6,ve(o,F)}}},[F,p]);var ve=function(o,v){var d=v,Z=v*(_-1),ge=v*(ee-1);o.clearRect(0,0,o.canvas.width,o.canvas.height),o.fillStyle=xn,o.fillRect(d,d,Z,ge),o.strokeStyle=pa,o.lineWidth=1;for(var Ze=0;Ze<ee;Ze++){var le=d+Ze*v;o.beginPath(),o.moveTo(d,le),o.lineTo(d+Z,le),o.stroke()}for(var N=0;N<_;N++){var ue=d+N*v;o.beginPath(),o.moveTo(ue,d),o.lineTo(ue,d+ge),o.stroke()}o.save(),o.fillStyle=xn,o.fillRect(d,d+4*v,Z,v),o.font="".concat(v/2.5,"px Arial"),o.fillStyle="#000",o.textAlign="center",o.textBaseline="middle",p?(o.fillText("\u6C49 \u754C",d+2*v,d+4.5*v),o.fillText("\u695A \u6CB3",d+7*v,d+4.5*v)):(o.fillText("\u695A \u6CB3",d+2*v,d+4.5*v),o.fillText("\u6C49 \u754C",d+7*v,d+4.5*v)),o.restore(),o.save(),o.font="bold ".concat(v/3,"px Arial"),o.textAlign="center",o.fillStyle="#333";var Te=["\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D","\u4E03","\u516B","\u4E5D"];if(p){for(var ce=0;ce<_;ce++){var Ce=d+ce*v,nr=ce;o.fillText(Te[nr],Ce,d/2)}for(var Ge=0;Ge<_;Ge++){var hr=d+Ge*v,Xe=_-Ge;o.fillText(Xe.toString(),hr,d+ge+d*.8)}}else{for(var Ve=0;Ve<_;Ve++){var Qr=d+Ve*v,Ar=Ve+1;o.fillText(Ar.toString(),Qr,d/2)}for(var he=0;he<_;he++){var Hr=d+he*v,Yr=_-he-1;o.fillText(Te[Yr],Hr,d+ge+d*.8)}}o.restore(),o.beginPath(),o.moveTo(d+3*v,d),o.lineTo(d+5*v,d+2*v),o.stroke(),o.beginPath(),o.moveTo(d+5*v,d),o.lineTo(d+3*v,d+2*v),o.stroke(),o.beginPath(),o.moveTo(d+3*v,d+7*v),o.lineTo(d+5*v,d+9*v),o.stroke(),o.beginPath(),o.moveTo(d+5*v,d+7*v),o.lineTo(d+3*v,d+9*v),o.stroke();var Y=function(O,de){var we=v/10;O<_-1&&(o.beginPath(),o.moveTo(d+O*v+we,d+de*v),o.lineTo(d+O*v+we*3,d+de*v),o.stroke(),o.beginPath(),o.moveTo(d+O*v,d+de*v+we),o.lineTo(d+O*v,d+de*v+we*3),o.stroke()),O>0&&(o.beginPath(),o.moveTo(d+O*v-we,d+de*v),o.lineTo(d+O*v-we*3,d+de*v),o.stroke(),o.beginPath(),o.moveTo(d+O*v,d+de*v+we),o.lineTo(d+O*v,d+de*v+we*3),o.stroke()),O<_-1&&de<ee-1&&(o.beginPath(),o.moveTo(d+O*v+we,d+de*v),o.lineTo(d+O*v+we*3,d+de*v),o.stroke(),o.beginPath(),o.moveTo(d+O*v,d+de*v-we),o.lineTo(d+O*v,d+de*v-we*3),o.stroke()),O>0&&de<ee-1&&(o.beginPath(),o.moveTo(d+O*v-we,d+de*v),o.lineTo(d+O*v-we*3,d+de*v),o.stroke(),o.beginPath(),o.moveTo(d+O*v,d+de*v-we),o.lineTo(d+O*v,d+de*v-we*3),o.stroke())};p?(Y(1,7),Y(7,7),Y(1,2),Y(7,2),Y(0,6),Y(2,6),Y(4,6),Y(6,6),Y(8,6),Y(0,3),Y(2,3),Y(4,3),Y(6,3),Y(8,3)):(Y(1,2),Y(7,2),Y(1,7),Y(7,7),Y(0,3),Y(2,3),Y(4,3),Y(6,3),Y(8,3),Y(0,6),Y(2,6),Y(4,6),Y(6,6),Y(8,6))},L=function(o,v){return f.some(function(d){return d.row===o&&d.col===v})},$=function(o,v){return i?i.from.row===o&&i.from.col===v||i.to.row===o&&i.to.col===v:!1},ne=function(o,v){if(!g){var d=p?ee-1-o:o,Z=p?_-1-v:v,ge=e[d][Z];if(a&&a.row===d&&a.col===Z){r(null);return}if(a&&L(d,Z)){u({row:d,col:Z});return}if(ge){r({row:d,col:Z});return}r(null)}},ae=function(o,v){var d=F,Z=p?ee-1-o:o,ge=p?_-1-v:v,Ze=d+Z*F,le=d+ge*F;return{position:"absolute",top:"".concat(Ze,"px"),left:"".concat(le,"px"),transform:"translate(-50%, -50%)",width:"".concat(F*.75,"px"),height:"".concat(F*.75,"px"),zIndex:5}},K=function(o,v){return p?{row:ee-1-o,col:_-1-v}:{row:o,col:v}};return(0,n.jsxs)("div",{ref:c,className:"relative inline-block bg-blue-50 p-8 rounded-xl mx-auto flex justify-center",style:{minWidth:"520px"},children:[(0,n.jsx)("canvas",{ref:re,className:"block"}),i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"absolute rounded-full bg-yellow-500 bg-opacity-30 pointer-events-none",style:B()(B()({},ae(i.from.row,i.from.col)),{},{width:F*.85,height:F*.85,zIndex:2})}),(0,n.jsx)("div",{className:"absolute rounded-full bg-yellow-600 animate-pulse pointer-events-none",style:B()(B()({},ae(i.to.row,i.to.col)),{},{width:F*.85,height:F*.85,boxShadow:"0 0 10px 2px rgba(234, 179, 8, 0.6)",zIndex:2})}),(0,n.jsxs)("svg",{className:"absolute pointer-events-none",style:{top:0,left:0,width:"100%",height:"100%",zIndex:1},children:[(0,n.jsx)("line",{x1:F+(p?_-1-i.from.col:i.from.col)*F,y1:F+(p?ee-1-i.from.row:i.from.row)*F,x2:F+(p?_-1-i.to.col:i.to.col)*F,y2:F+(p?ee-1-i.to.row:i.to.row)*F,stroke:"rgba(234, 179, 8, 0.8)",strokeWidth:"3",strokeDasharray:"7,3",pointerEvents:"none",markerEnd:"url(#arrowhead)"}),(0,n.jsx)("defs",{children:(0,n.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"10",refY:"3.5",orient:"auto",pointerEvents:"none",children:(0,n.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"rgba(234, 179, 8, 0.8)",pointerEvents:"none"})})})]})]}),l&&(0,n.jsx)("div",{className:"absolute rounded-full animate-pulse",style:B()(B()({},ae(l.row,l.col)),{},{width:F*.8,height:F*.8,backgroundColor:"rgba(220, 38, 38, 0.3)",border:"2px solid rgba(220, 38, 38, 0.8)",zIndex:3})}),f.map(function(A){var o=A.row,v=A.col,d=K(o,v);return(0,n.jsx)("div",{className:"absolute rounded-full cursor-pointer hover:bg-blue-400 transition-all duration-150",style:B()(B()({},ae(o,v)),{},{width:F/3,height:F/3,backgroundColor:"rgba(59, 130, 246, 0.5)",boxShadow:"0 0 5px 1px rgba(59, 130, 246, 0.7)",border:"2px solid rgba(255, 255, 255, 0.8)",zIndex:30,animation:"validMoveIndicator 1.5s infinite"}),onClick:function(){return ne(d.row,d.col)}},"valid-".concat(o,"-").concat(v))}),(0,n.jsx)("style",{children:`
        @keyframes validMoveIndicator {
          0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.7; }
          50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.7; }
        }
      `}),e.map(function(A,o){return A.map(function(v,d){if(!v)return null;var Z=K(o,d);return(0,n.jsx)("div",{style:B()(B()({},ae(o,d)),{},{zIndex:20}),onClick:function(){return ne(Z.row,Z.col)},children:(0,n.jsx)(_e,{piece:v,size:F*.75,isSelected:(a==null?void 0:a.row)===o&&(a==null?void 0:a.col)===d,isStartPosition:!1})},v.id)})})]})}var E=C(7651),wa=C(82257),ba=C(68872),wn=C(55102),Xr=C(83622),bn=C(53219),Ca=C(6620),Cn=C(1470),ja=C(47737),jn=C(43777),kn=C(41352),ka=["isHidden","originalPosition"],Na=["isHidden","originalPosition"];function Nn(t){return{id:String((t==null?void 0:t.id)||""),name:(t==null?void 0:t.userName)||"\u6E38\u5BA2",avatar:(t==null?void 0:t.userAvatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat((t==null?void 0:t.id)||"visitor"),level:(t==null?void 0:t.level)||1,isAdmin:(t==null?void 0:t.userRole)==="admin"}}function Fa(){var t=(0,wa.useModel)("@@initialState"),e=t.initialState,r=t.setInitialState,u=e||{},a=u.currentUser,f=(0,j.useState)("single"),i=I()(f,2),l=i[0],g=i[1],y=(0,j.useState)("normal"),p=I()(y,2),c=p[0],x=p[1],k=(0,j.useState)("connecting"),F=I()(k,2),M=F[0],H=F[1],W=(0,j.useState)(""),P=I()(W,2),D=P[0],re=P[1],ve=(0,j.useState)("black"),L=I()(ve,2),$=L[0],ne=L[1],ae=(0,j.useState)(""),K=I()(ae,2),A=K[0],o=K[1],v=(0,j.useState)(null),d=I()(v,2),Z=d[0],ge=d[1],Ze=(0,j.useState)("red"),le=I()(Ze,2),N=le[0],ue=le[1],Te=(0,j.useState)("red"),ce=I()(Te,2),Ce=ce[0],nr=ce[1],Ge=(0,j.useState)(!1),hr=I()(Ge,2),Xe=hr[0],Ve=hr[1],Qr=ba.ZP.useMessage(),Ar=I()(Qr,2),he=Ar[0],Hr=Ar[1],Yr=(0,j.useState)(Ee(c)),Y=I()(Yr,2),z=Y[0],O=Y[1],de=(0,j.useRef)(z),we=(0,j.useState)("red"),Fn=I()(we,2),T=Fn[0],ye=Fn[1],Ea=(0,j.useState)(null),Bn=I()(Ea,2),oe=Bn[0],Pe=Bn[1],Sa=(0,j.useState)([]),En=I()(Sa,2),qr=En[0],Ue=En[1],Ma=(0,j.useState)([]),Sn=I()(Ma,2),Oe=Sn[0],je=Sn[1],Ia=(0,j.useState)(null),Mn=I()(Ia,2),cr=Mn[0],ke=Mn[1],Da=(0,j.useState)(null),In=I()(Da,2),gr=In[0],me=In[1],Aa=(0,j.useState)(null),Dn=I()(Aa,2),Se=Dn[0],Ne=Dn[1],Ha=(0,j.useState)(!1),An=I()(Ha,2),mr=An[0],Fe=An[1],Ta=(0,j.useState)(!1),Hn=I()(Ta,2),Oa=Hn[0],Fr=Hn[1],Ra=(0,j.useState)(!1),Tn=I()(Ra,2),Wa=Tn[0],Qe=Tn[1],_a=(0,j.useState)(null),On=I()(_a,2),dr=On[0],Me=On[1],La=(0,j.useState)(!1),Rn=I()(La,2),Br=Rn[0],Be=Rn[1],Ja=(0,j.useState)(!1),Wn=I()(Ja,2),Za=Wn[0],Re=Wn[1],Va=(0,j.useState)(!0),_n=I()(Va,2),jt=_n[0],kt=_n[1],Ua=(0,j.useState)([]),Ln=I()(Ua,2),Jn=Ln[0],yr=Ln[1],$a=(0,j.useState)(""),Zn=I()($a,2),Pr=Zn[0],Er=Zn[1],Ka=(0,j.useState)("chat"),Vn=I()(Ka,2),Tr=Vn[0],Un=Vn[1],Ga=(0,j.useState)(!1),$n=I()(Ga,2),zr=$n[0],Kn=$n[1],Xa=(0,j.useState)(0),Gn=I()(Xa,2),Qa=Gn[0],Xn=Gn[1],Qn=(0,j.useRef)(null),Ya=(0,j.useState)(!1),Yn=I()(Ya,2),Nt=Yn[0],Ft=Yn[1],en=(0,j.useRef)(!1),qa=(0,j.useState)(!1),qn=I()(qa,2),rn=qn[0],Pa=qn[1];(0,j.useEffect)(function(){de.current=z},[z]);var tr=(0,j.useCallback)(function(){l==="online"&&r(function(s){return B()(B()({},s),{},{chessGameState:{mode:l,onlineStatus:M,roomId:D,opponentColor:$,opponentUserId:A,opponentInfo:Z,playerColor:N,gameStarted:Xe,board:JSON.parse(JSON.stringify(z)),moveHistory:fe()(Oe),lastMove:cr?B()({},cr):null,currentPlayer:T,checkPosition:gr?B()({},gr):null,isCheck:Br}})})},[l,M,D,$,A,Z,N,Xe,z,Oe,cr,T,gr,Br,r]);(0,j.useEffect)(function(){return function(){tr()}},[tr]),(0,j.useEffect)(function(){var s=window.location,m=new URLSearchParams(s.search),w=m.get("roomId"),h=m.get("mode");return w&&!en.current?(re(w),g("online"),console.log("\u4ECEURL\u83B7\u53D6\u623F\u95F4\u53F7\uFF0C\u4F5C\u4E3A\u52A0\u5165\u8005:",w),O(Ee(c)),ye("red"),Ne(null),je([]),ke(null),me(null),Pe(null),Ue([]),ue("black"),ne("red"),H("connecting"),localStorage.setItem("chess_is_joiner","true"),nn(function(){tn(w)}),en.current=!0):!w&&!en.current&&(localStorage.removeItem("chess_is_joiner"),an()),h&&g(h),function(){an(),tr()}},[]),(0,j.useEffect)(function(){if(!(l!=="online"||!Xe)){var s=setInterval(function(){!E.o.isConnected()&&(M==="playing"||M==="waiting")&&(console.log("\u68C0\u6D4B\u5230WebSocket\u8FDE\u63A5\u65AD\u5F00\uFF0C\u5C1D\u8BD5\u91CD\u8FDE..."),he.warning("\u8FDE\u63A5\u65AD\u5F00\uFF0C\u6B63\u5728\u5C1D\u8BD5\u91CD\u8FDE..."),nn(function(){console.log("\u91CD\u8FDE\u6210\u529F\uFF0C\u5C1D\u8BD5\u6062\u590D\u6E38\u620F\u72B6\u6001"),he.success("\u91CD\u8FDE\u6210\u529F");var m=localStorage.getItem("chess_is_joiner")==="true";m&&D?tn(D):D&&M==="waiting"&&Pn()}))},15e3);return function(){clearInterval(s)}}},[l,Xe,M,D]);var nn=(0,j.useCallback)(function(s){console.log("\u68C0\u67E5WebSocket\u8FDE\u63A5..."),za();var m=localStorage.getItem("tokenValue");if(!m){he.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}if(E.o.isConnected()){console.log("WebSocket\u5DF2\u8FDE\u63A5\uFF0C\u76F4\u63A5\u6267\u884C\u56DE\u8C03"),s==null||s();return}var w=function h(b){b.type===1&&(console.log("WebSocket\u8FDE\u63A5\u6210\u529F"),E.o.removeMessageHandler("connected",h),setTimeout(function(){s==null||s()},500))};E.o.addMessageHandler("connected",w),E.o.connect(m),setTimeout(function(){E.o.isConnected()||he.error("\u8FDE\u63A5\u670D\u52A1\u5668\u8D85\u65F6\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5")},1e4)},[]),za=(0,j.useCallback)(function(){console.log("\u8BBE\u7F6EWebSocket\u6D88\u606F\u5904\u7406\u5668"),an(),E.o.addMessageHandler("chat",Or),E.o.addMessageHandler("joinSuccess",Rr),E.o.addMessageHandler("createChessRoom",Wr),E.o.addMessageHandler("moveChess",Jr),E.o.addMessageHandler("requestBoardSync",_r),E.o.addMessageHandler("boardSync",Lr),E.o.addMessageHandler("gameEnd",Zr),E.o.addMessageHandler("error",function(s){})},[]),an=(0,j.useCallback)(function(){console.log("\u6E05\u7406WebSocket\u6D88\u606F\u5904\u7406\u5668");try{E.o.clearMessageHandlers()}catch(s){console.error("\u6E05\u7406WebSocket\u5904\u7406\u5668\u51FA\u9519:",s)}},[]),tn=(0,j.useCallback)(function(s){if(console.log("\u53D1\u9001\u52A0\u5165\u623F\u95F4\u8BF7\u6C42, \u623F\u95F4ID:",s),!E.o.isConnected()){console.log("WebSocket\u672A\u8FDE\u63A5\uFF0C\u7B49\u5F85\u8FDE\u63A5\u540E\u518D\u53D1\u9001\u8BF7\u6C42");return}localStorage.setItem("chess_is_joiner","true"),ue("black"),ne("red"),E.o.send({type:2,userId:-1,data:{type:"joinRoom",content:s,playerInfo:Nn(a)}})},[a]),Pn=(0,j.useCallback)(function(){if(console.log("\u53D1\u9001\u521B\u5EFA\u623F\u95F4\u8BF7\u6C42"),!E.o.isConnected()){console.log("WebSocket\u672A\u8FDE\u63A5\uFF0C\u7B49\u5F85\u8FDE\u63A5\u540E\u518D\u53D1\u9001\u8BF7\u6C42");return}localStorage.removeItem("chess_is_joiner"),ue("red"),ne("black");var s=c;console.log("\u6B63\u5728\u521B\u5EFA\u623F\u95F4\uFF0C\u4F60\u5C06\u6267\u7EA2\u5148\u624B\uFF0C\u4F7F\u7528\u6E38\u620F\u7C7B\u578B: ".concat(s)),E.o.send({type:2,userId:-1,data:{type:"createChessRoom",content:JSON.stringify({gameType:s}),playerInfo:Nn(a)}})},[a,c]),zn=(0,j.useCallback)(function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;if(s>m){console.log("\u5DF2\u53D1\u9001".concat(m,"\u6B21\u540C\u6B65\u8BF7\u6C42\uFF0C\u505C\u6B62\u5C1D\u8BD5"));return}if(console.log("\u53D1\u9001\u68CB\u76D8\u540C\u6B65\u8BF7\u6C42\uFF0C\u7B2C".concat(s,"\u6B21\u5C1D\u8BD5")),!E.o.isConnected()){console.log("WebSocket\u672A\u8FDE\u63A5\uFF0C\u7B49\u5F85\u8FDE\u63A5\u540E\u518D\u8BF7\u6C42\u540C\u6B65"),setTimeout(function(){D&&M==="playing"&&!Sr.current&&zn(s,m)},2e3);return}E.o.send({type:2,userId:-1,data:{type:"requestBoardSync",content:{roomId:D}}});var w=2e3+s*1e3;setTimeout(function(){D&&M==="playing"&&!Sr.current&&zn(s+1,m)},w)},[D,M]),Sr=(0,j.useRef)(!1),ea=(0,j.useRef)(!1),et=(0,j.useCallback)(function(s){var m=T===N;if(!(l==="online"&&!m)){if(l==="self"&&s){var w=z[s.row][s.col];if(w&&w.player!==T)return}if(Pe(s),s){var h=z[s.row][s.col];if(h&&h.player===T){for(var b=[],S=0;S<z.length;S++)for(var R=0;R<z[S].length;R++)ur(z,s,{row:S,col:R},c)&&b.push({row:S,col:R});if(h.type==="general"){var X=T==="red"?"black":"red",q=er(z,X);if(q&&q.col===s.col){for(var te=!1,J=Math.min(s.row,q.row)+1,$e=Math.max(s.row,q.row),Ye=J;Ye<$e;Ye++)if(z[Ye][s.col]!==null){te=!0;break}te||b.some(function(Ke){return Ke.row===q.row&&Ke.col===q.col})||b.push(q)}}Ue(b)}else Ue([])}else Ue([])}},[z,T,l,N,c]),rt=(0,j.useCallback)(function(s){if(oe){if(l==="online"&&T!==N){console.log("\u4E0D\u662F\u4F60\u7684\u56DE\u5408\uFF0C\u65E0\u6CD5\u79FB\u52A8\u68CB\u5B50");return}if(qr.some(function(qe){return qe.row===s.row&&qe.col===s.col})){var m=l==="single"||l==="self";if(m){var w=z[oe.row][oe.col],h=z[s.row][s.col];if(!w)return;var b=Je(z,oe,s,c);if(O(b),je(function(qe){return[].concat(fe()(qe),[{from:oe,to:s,piece:w,capturedPiece:h||null,number:qe.length+1}])}),ke({from:oe,to:s}),h){if(Me({position:s,piece:h,player:T,timestamp:Date.now(),eatingPiece:w}),h.type==="general"){Ne({winner:T,reason:"capture"}),Qe(!0);return}setTimeout(function(){Me(null)},3e3)}var S=T==="red"?"black":"red",R=Le(b,S,!1,c);if(R.inCheck){if(Be(!0),Re(!0),me(er(b,S)),rr(b,S,!1,c)){Ne({winner:T,reason:"checkmate"}),Qe(!0);return}setTimeout(function(){Re(!1)},2e3)}else Be(!1),me(null);ye(S),Pe(null),Ue([]),l==="single"&&!Se&&Fe(!0)}else{if(M!=="playing"){he.open({type:"info",content:"\u5BF9\u624B\u8FD8\u6CA1\u52A0\u5165\u5462\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\uFF5E"});return}var X=z[oe.row][oe.col],q=z[s.row][s.col];if(!X)return;console.log("\u53D1\u9001\u79FB\u52A8\u68CB\u5B50\u8BF7\u6C42:",{from:oe,to:s,player:N,pieceType:X.type});var te=JSON.parse(JSON.stringify(z)),J;if(c==="hidden"&&X.isHidden){console.log("[\u53D1\u9001-\u672C\u5730] \u5904\u7406\u6697\u68CB\u79FB\u52A8:",{\u539F\u68CB\u5B50:JSON.stringify(X),\u4F4D\u7F6E:"\u4ECE(".concat(oe.row,",").concat(oe.col,")\u5230(").concat(s.row,",").concat(s.col,")"),\u73A9\u5BB6:N}),te[oe.row][oe.col]=null;var $e=X,Ye=$e.isHidden,Ke=$e.originalPosition,pr=lr()($e,ka);J=B()(B()({},pr),{},{id:"".concat(N,"-").concat(X.type,"-").concat(oe.row,"-").concat(oe.col,"-").concat(s.row,"-").concat(s.col)}),console.log("[\u53D1\u9001-\u672C\u5730] \u521B\u5EFA\u7684\u660E\u5B50:",JSON.stringify(J)),te[s.row][s.col]=J}else J=B()(B()({},X),{},{id:"".concat(N,"-").concat(X.type,"-").concat(oe.row,"-").concat(oe.col,"-").concat(s.row,"-").concat(s.col)}),te[oe.row][oe.col]=null,te[s.row][s.col]=J;O(te),de.current=te;var xr=c==="hidden"&&X.isHidden;if(console.log("[\u53D1\u9001] \u79FB\u52A8\u68CB\u5B50\u8BE6\u7EC6\u4FE1\u606F:",{gameType:c,isHiddenPiece:xr,movingPiece:JSON.stringify(X),from:oe,to:s,player:N}),E.o.send({type:2,userId:A,data:{type:"moveChess",content:{roomId:D,from:oe,to:s,player:N,pieceType:X.type,isHiddenPiece:xr,pieceInfo:xr?{type:X.type,player:N}:void 0,playerInfo:{id:a==null?void 0:a.id,name:a==null?void 0:a.userName,avatar:a==null?void 0:a.userAvatar,level:a==null?void 0:a.level}}}}),console.log("[\u53D1\u9001] WebSocket\u6D88\u606F\u5DF2\u53D1\u9001:",{isHiddenPiece:xr,pieceType:X.type,player:N}),je(function(qe){return[].concat(fe()(qe),[{from:oe,to:s,piece:J,capturedPiece:q||null,number:qe.length+1}])}),ke({from:oe,to:s}),q){if(Me({position:s,piece:q,player:T,timestamp:Date.now(),eatingPiece:J}),q.type==="general"){Ne({winner:T,reason:"capture"}),Qe(!0),E.o.send({type:2,userId:A,data:{type:"gameEnd",content:{roomId:D,winner:T,reason:"capture"}}});return}setTimeout(function(){Me(null)},3e3)}var sr=T==="red"?"black":"red",Mr=Le(te,sr,!1,c);if(Mr.inCheck){if(Be(!0),Re(!0),me(er(te,sr)),rr(te,sr,!1,c)){Ne({winner:T,reason:"checkmate"}),Qe(!0),E.o.send({type:2,userId:A,data:{type:"gameEnd",content:{roomId:D,winner:T,reason:"checkmate"}}});return}setTimeout(function(){Re(!1)},2e3)}else Be(!1),me(null);ye(sr),Pe(null),Ue([]),tr()}}}},[z,oe,qr,T,l,M,N,A,D,he,tr,a,Se,c]),nt=function(){var m;(m=Qn.current)===null||m===void 0||m.scrollIntoView({behavior:"smooth"})};(0,j.useEffect)(function(){nt()},[Jn]);var Or=function(m){var w=m.data.message;w.sender.id!==String(a==null?void 0:a.id)&&yr(function(h){return[].concat(fe()(h),[B()({},w)])})},Rr=function(m){var w=localStorage.getItem("chess_is_joiner")==="true",h=m.data.gameType||"normal";console.log("\u6536\u5230\u52A0\u5165\u6210\u529F\u6D88\u606F\uFF0C\u6E38\u620F\u7C7B\u578B: ".concat(h)),console.log("\u5F53\u524D\u6E38\u620F\u7C7B\u578B: ".concat(c,", \u5C06\u66F4\u65B0\u4E3A: ").concat(h)),x(h),w?(ne("red"),ue("black"),H("playing"),Ve(!0),o(m.data.playerId),ge(m.data.playerInfo),ye("red"),he.open({type:"success",content:"\u6218\u6597\u5F00\u59CB\uFF01\uFF01\uFF01(".concat(h==="hidden"?"\u63ED\u68CB\u6A21\u5F0F":"\u666E\u901A\u6A21\u5F0F",")")}),console.log("\u52A0\u5165\u623F\u95F4\u6210\u529F\uFF0C\u8BF7\u6C42\u540C\u6B65\u68CB\u76D8"),setTimeout(function(){D&&!Sr.current&&(E.o.send({type:2,userId:-1,data:{type:"requestBoardSync",content:{roomId:D}}}),ea.current=!0)},1e3)):(ne("black"),ue("red"),H("playing"),o(m.data.playerId),ge(m.data.playerInfo),he.open({type:"success",content:"\u5BF9\u624B\u5DF2\u52A0\u5165\uFF0C\u6218\u6597\u5F00\u59CB\uFF01\uFF01\uFF01(".concat(h==="hidden"?"\u63ED\u68CB\u6A21\u5F0F":"\u666E\u901A\u6A21\u5F0F",")")})),console.log("\u4F7F\u7528\u6E38\u620F\u7C7B\u578B ".concat(h," \u521B\u5EFA\u521D\u59CB\u68CB\u76D8"));var b=Ee(h);O(b),tr()},Wr=function(m){console.log("\u521B\u5EFA\u623F\u95F4\u6210\u529F",m.data);var w="",h=c;pe()(m.data)==="object"&&m.data!==null?(w=m.data.roomId||"",h=m.data.gameType||c,console.log("\u6536\u5230\u670D\u52A1\u5668\u8FD4\u56DE\u7684\u6E38\u620F\u7C7B\u578B: ".concat(h)),h!==c&&(console.log("\u66F4\u65B0\u6E38\u620F\u7C7B\u578B\u4ECE ".concat(c," \u5230 ").concat(h)),x(h))):w=m.data,re(w),H("waiting"),Be(!1),Re(!1),me(null),console.log("\u521B\u5EFA\u623F\u95F4\u4F7F\u7528\u6E38\u620F\u7C7B\u578B: ".concat(h));var b=Ee(h);O(b),he.open({type:"success",content:"\u623F\u95F4\u521B\u5EFA\u6210\u529F\u5566 (".concat(h==="hidden"?"\u63ED\u68CB\u6A21\u5F0F":"\u666E\u901A\u6A21\u5F0F",")")}),Ve(!0),tr()},_r=(0,j.useCallback)(function(s){console.log("\u6536\u5230\u68CB\u76D8\u540C\u6B65\u8BF7\u6C42"),N==="red"&&D&&M==="playing"&&(E.o.send({type:2,userId:A,data:{type:"boardSync",content:{roomId:D,board:z,currentPlayer:T,moveHistory:Oe,lastMove:cr,checkPosition:gr,isCheck:Br,gameType:c}}}),console.log("\u5DF2\u53D1\u9001\u68CB\u76D8\u540C\u6B65\u6570\u636E"))},[z,T,Br,Oe,cr,gr,A,M,N,D,c]),Lr=(0,j.useCallback)(function(s){console.log("\u6536\u5230\u68CB\u76D8\u540C\u6B65\u6570\u636E",s.data);var m=s.data;if(!(!m||N==="red")){if(m.gameType){var w=m.gameType;console.log("\u6536\u5230\u6E38\u620F\u7C7B\u578B: ".concat(w)),x(w);var h=m.board||Ee(w);console.log("\u4F7F\u7528\u6E38\u620F\u7C7B\u578B ".concat(w," \u8BBE\u7F6E\u68CB\u76D8")),O(h)}else O(m.board||Ee("normal"));ye(m.currentPlayer||"red"),je(m.moveHistory||[]),m.lastMove&&ke(m.lastMove),m.checkPosition?(me(m.checkPosition),Be(m.isCheck||!1)):(me(null),Be(!1)),Sr.current=!0,console.log("\u68CB\u76D8\u540C\u6B65\u5B8C\u6210")}},[N]),Jr=function(m){var w=m.data,h=w.from,b=w.to,S=w.player,R=w.pieceType,X=w.isHiddenPiece,q=w.pieceInfo,te=X===!0;te&&c!=="hidden"&&(console.log("[\u63A5\u6536] \u8B66\u544A: \u6536\u5230\u6697\u68CB\u79FB\u52A8\u8BF7\u6C42\uFF0C\u4F46\u5F53\u524D\u6E38\u620F\u7C7B\u578B\u662F:",c),console.log("[\u63A5\u6536] \u5F3A\u5236\u66F4\u65B0\u6E38\u620F\u7C7B\u578B\u4E3A hidden"),x("hidden")),console.log("[\u63A5\u6536] \u6536\u5230\u5BF9\u65B9\u79FB\u52A8\u68CB\u5B50\u8BF7\u6C42:",JSON.stringify(m.data)),console.log("[\u63A5\u6536] \u5BF9\u65B9\u8BF7\u6C42\u79FB\u52A8: \u4ECE(".concat(h.row,",").concat(h.col,")\u5230(").concat(b.row,",").concat(b.col,"), \u73A9\u5BB6: ").concat(S,", \u662F\u5426\u4E3A\u6697\u68CB: ").concat(te?"true":"false",", \u68CB\u5B50\u7C7B\u578B: ").concat(R)),console.log("[\u63A5\u6536] \u5F53\u524D\u6E38\u620F\u7C7B\u578B:",c),console.log("[\u63A5\u6536] \u63A5\u6536\u5230\u7684pieceInfo:",q),console.log("[\u63A5\u6536] isHiddenPiece\u539F\u59CB\u503C:",X,"\u7C7B\u578B:",pe()(X));var J=JSON.parse(JSON.stringify(de.current)),$e=J[b.row][b.col],Ye=J[h.row]&&J[h.row][h.col];if(console.log("[\u63A5\u6536] \u6E90\u4F4D\u7F6E\u68CB\u5B50:",Ye?JSON.stringify(Ye):"\u65E0"),Ye&&Ye.player===S){var Ke=J[h.row][h.col];if(J[h.row][h.col]=null,te){console.log("[\u63A5\u6536] \u5904\u7406\u63ED\u68CB\u6A21\u5F0F\u4E0B\u7684\u6697\u5B50\u7FFB\u8F6C - \u5F3A\u5236\u6267\u884C"),console.log("[\u63A5\u6536] \u539F\u59CB\u68CB\u5B50:",JSON.stringify(Ke)),console.log("[\u63A5\u6536] \u6807\u51C6\u5316\u540E\u7684isHidden\u503C:",te);var pr={type:R,player:S,id:"".concat(S,"-").concat(R,"-").concat(h.row,"-").concat(h.col,"-").concat(b.row,"-").concat(b.col)};console.log("[\u63A5\u6536] \u521B\u5EFA\u7684\u65B0\u660E\u5B50:",JSON.stringify(pr)),J[b.row][b.col]=pr}else{if(console.log("[\u63A5\u6536] \u5904\u7406\u666E\u901A\u68CB\u5B50\u79FB\u52A8"),Ke.isHidden){console.log("[\u63A5\u6536] \u68C0\u6D4B\u5230\u6697\u68CB\uFF0C\u4F46\u672A\u6807\u8BB0\u4E3AisHiddenPiece\uFF0C\u5F3A\u5236\u7FFB\u8F6C");var xr=Ke.isHidden,sr=Ke.originalPosition,Mr=lr()(Ke,Na),qe=B()(B()({},Mr),{},{type:R,player:S,id:"".concat(S,"-").concat(R,"-").concat(h.row,"-").concat(h.col,"-").concat(b.row,"-").concat(b.col)});console.log("[\u63A5\u6536] \u5F3A\u5236\u7FFB\u8F6C\u540E\u7684\u68CB\u5B50:",JSON.stringify(qe)),J[b.row][b.col]=qe;return}var aa=B()(B()({},Ke),{},{id:"".concat(S,"-").concat(R,"-").concat(h.row,"-").concat(h.col,"-").concat(b.row,"-").concat(b.col)});console.log("[\u63A5\u6536] \u79FB\u52A8\u540E\u7684\u68CB\u5B50:",JSON.stringify(aa)),J[b.row][b.col]=aa}}else if(console.log("[\u63A5\u6536] \u6E90\u4F4D\u7F6E(".concat(h.row,",").concat(h.col,")\u6CA1\u6709\u627E\u5230\u5BF9\u5E94\u7684\u68CB\u5B50\uFF0C\u521B\u5EFA\u65B0\u68CB\u5B50")),console.log("[\u63A5\u6536] \u68CB\u76D8\u72B6\u6001\u68C0\u67E5:",{gameType:c,isHiddenPiece:X,pieceInfo:q,sourcePieceExists:!!J[h.row]&&!!J[h.row][h.col],sourcePiecePlayer:J[h.row]&&J[h.row][h.col]?J[h.row][h.col].player:"none"}),te){console.log("[\u63A5\u6536] \u521B\u5EFA\u6697\u68CB\u7FFB\u8F6C\u540E\u7684\u660E\u5B50 - \u5F3A\u5236\u6267\u884C"),console.log("[\u63A5\u6536] \u6807\u51C6\u5316\u540E\u7684isHidden\u503C:",te);var ta={type:q&&q.type?q.type:R,player:q&&q.player?q.player:S,id:"".concat(S,"-").concat(R,"-").concat(h.row,"-").concat(h.col,"-").concat(b.row,"-").concat(b.col)};console.log("[\u63A5\u6536] \u65B0\u521B\u5EFA\u7684\u660E\u5B50:",JSON.stringify(ta)),J[b.row][b.col]=ta}else{console.log("[\u63A5\u6536] \u521B\u5EFA\u666E\u901A\u68CB\u5B50");var sa={type:R,player:S,id:"".concat(S,"-").concat(R,"-").concat(h.row,"-").concat(h.col,"-").concat(b.row,"-").concat(b.col)};console.log("[\u63A5\u6536] \u65B0\u521B\u5EFA\u7684\u666E\u901A\u68CB\u5B50:",JSON.stringify(sa)),J[b.row][b.col]=sa}if(console.log("[\u63A5\u6536] \u66F4\u65B0\u68CB\u76D8: ".concat(S,"\u65B9 ").concat(R," \u653E\u7F6E\u5728 (").concat(b.row,",").concat(b.col,")")),console.log("[\u63A5\u6536] \u76EE\u6807\u4F4D\u7F6E\u7684\u65B0\u68CB\u5B50:",JSON.stringify(J[b.row][b.col])),O(J),de.current=J,setTimeout(function(){var fr=de.current;console.log("[\u63A5\u6536] \u66F4\u65B0\u540E\u7684\u68CB\u5B50\u72B6\u6001:",{\u4F4D\u7F6E:"(".concat(b.row,",").concat(b.col,")"),\u68CB\u5B50:fr[b.row][b.col]?JSON.stringify(fr[b.row][b.col]):"\u65E0",\u662F\u5426\u4E3A\u6697\u68CB:fr[b.row][b.col]&&fr[b.row][b.col].isHidden?"\u662F":"\u5426"})},100),je(function(fr){return[].concat(fe()(fr),[{from:h,to:b,piece:J[b.row][b.col],capturedPiece:$e||null,number:fr.length+1}])}),ke({from:h,to:b}),$e){if(Me({position:b,piece:$e,player:S,timestamp:Date.now(),eatingPiece:J[b.row][b.col]}),$e.type==="general"){Ne({winner:S,reason:"capture"}),Qe(!0);return}setTimeout(function(){Me(null)},3e3)}var Vr=S==="red"?"black":"red",gt=Le(J,Vr,!1,c);if(gt.inCheck){Be(!0),Re(!0);var la=er(J,Vr);if(la&&me(la),rr(J,Vr,!1,c)){Ne({winner:S,reason:"checkmate"}),Qe(!0);return}setTimeout(function(){Re(!1)},2e3)}else Be(!1),me(null);ye(Vr),Pe(null),Ue([]),m.data.playerInfo&&ge(m.data.playerInfo),tr()},Bt=function(m,w,h){Me({position:m,piece:w,player:h.player,timestamp:Date.now(),eatingPiece:h}),w.type==="general"&&(Ne({winner:h.player,reason:"capture"}),Qe(!0)),setTimeout(function(){Me(null)},3e3)},Zr=(0,j.useCallback)(function(s){var m=s.data.content,w=m.winner,h=m.reason;Ne({winner:w,reason:h}),Qe(!0)},[]);(0,j.useEffect)(function(){var s=E.o.addMessageHandler;return E.o.addMessageHandler=function(m,w){var h=function(S){return m==="moveChess"&&(console.log("[WebSocket\u62E6\u622A\u5668] \u6536\u5230moveChess\u6D88\u606F:",JSON.stringify(S)),console.log("[WebSocket\u62E6\u622A\u5668] isHiddenPiece\u503C:",S.data.isHiddenPiece),console.log("[WebSocket\u62E6\u622A\u5668] pieceInfo\u503C:",S.data.pieceInfo)),w(S)};return s.call(E.o,m,h)},function(){E.o.addMessageHandler=s}},[]),(0,j.useEffect)(function(){return function(){E.o.removeMessageHandler("chat",Or),E.o.removeMessageHandler("joinSuccess",Rr),E.o.removeMessageHandler("createChessRoom",Wr),E.o.removeMessageHandler("moveChess",Jr),E.o.removeMessageHandler("requestBoardSync",_r),E.o.removeMessageHandler("boardSync",Lr),E.o.removeMessageHandler("gameEnd",Zr)}},[]),(0,j.useEffect)(function(){if(l==="online"){var s=localStorage.getItem("tokenValue");if(!s||!(a!=null&&a.id)){he.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}return E.o.addMessageHandler("chat",Or),E.o.addMessageHandler("joinSuccess",Rr),E.o.addMessageHandler("createChessRoom",Wr),E.o.addMessageHandler("moveChess",Jr),E.o.addMessageHandler("requestBoardSync",_r),E.o.addMessageHandler("boardSync",Lr),E.o.addMessageHandler("gameEnd",Zr),E.o.connect(s),function(){E.o.removeMessageHandler("chat",Or),E.o.removeMessageHandler("joinSuccess",Rr),E.o.removeMessageHandler("createChessRoom",Wr),E.o.removeMessageHandler("moveChess",Jr),E.o.removeMessageHandler("requestBoardSync",_r),E.o.removeMessageHandler("boardSync",Lr),E.o.removeMessageHandler("gameEnd",Zr)}}},[l,a==null?void 0:a.id]);var ra=function(){if(Pr.trim()){if(!(a!=null&&a.id)){he.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}var m={id:"".concat(Date.now()),content:Pr,sender:{id:String(a.id),name:a.userName||"\u6E38\u5BA2",avatar:a.userAvatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:a.level||1,isAdmin:a.userRole==="admin"},timestamp:new Date};E.o.send({type:2,userId:-1,data:{type:"chat",content:{message:m}}}),yr(function(w){return[].concat(fe()(w),[m])}),Er("")}},at=function(){if(!(a!=null&&a.id)){he.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}if(zr){he.warning("\u4F60\u5DF2\u7ECF\u53D1\u9001\u8FC7\u9080\u8BF7\u4E86\uFF0C\u8BF7\u7B49\u5F8560\u79D2\u540E\u518D\u8BD5");return}E.o.send({type:2,userId:-1,data:{type:"chat",content:{message:{id:"".concat(Date.now()),content:"[invite/chineseChess]".concat(D,"[/invite]"),sender:{id:String(a.id),name:a.userName||"\u6E38\u5BA2",avatar:a.userAvatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:a.level||1,isAdmin:a.userRole==="admin"},timestamp:new Date}}}}),Kn(!0),Xn(60),he.success("\u9080\u8BF7\u5DF2\u53D1\u9001\u5230\u804A\u5929\u5BA4");var m=setInterval(function(){Xn(function(w){return w<=1?(clearInterval(m),Kn(!1),0):w-1})},1e3)},tt=function(){Ve(!1),g("single"),O(Ee()),ye("red"),Ne(null),je([]),ke(null),me(null),Pe(null),Ue([]),Be(!1),Me(null),yr([]),Er(""),re(""),Qe(!1)},Et=function(){Qe(!1)};(0,j.useEffect)(function(){var s,m=function(){try{var h=kr(z,T);if(!h){Fe(!1);return}var b=Je(z,h.from,h.to,c),S=z[h.to.row][h.to.col],R=z[h.from.row][h.from.col];if(!R){Fe(!1);return}if(O(b),ke({from:h.from,to:h.to}),S){if(Me({position:h.to,piece:S,player:T,timestamp:Date.now(),eatingPiece:R}),S.type==="general"){Ne({winner:T,reason:"capture"}),Fe(!1);return}setTimeout(function(){Me(null)},3e3)}je(function(te){return[].concat(fe()(te),[{from:h.from,to:h.to,piece:R,capturedPiece:S||null,number:te.length+1}])});var X=T==="red"?"black":"red",q=Le(b,X);if(q.inCheck){if(Be(!0),Re(!0),me(er(b,X)),rr(b,X)){Ne({winner:T,reason:"checkmate"}),Fe(!1);return}setTimeout(function(){Re(!1)},2e3)}else Be(!1),me(null);ye(X),Fe(!1)}catch(te){console.error("AI move error:",te),Fe(!1)}};return l==="single"&&Xe&&T!==N&&!Se&&(Fe(!0),s=setTimeout(m,800)),function(){s&&clearTimeout(s)}},[l,Xe,T,z,Se,N,c]);var na=function(m){ue(m),Ve(!0),Fe(!1),O(Ee(c)),ye("red"),Ne(null),je([]),ke(null),me(null),Pe(null),Ue([]),Be(!1),Re(!1),Me(null),yr([]),Er(""),re("");var w=Ee(c);m==="black"&&l==="single"&&(Fe(!0),setTimeout(function(){try{var h=kr(w,"red");if(h){var b=Je(w,h.from,h.to,c);O(b),ke({from:h.from,to:h.to});var S=w[h.from.row][h.from.col];S&&je([{from:h.from,to:h.to,piece:S,capturedPiece:w[h.to.row][h.to.col]||null,number:1}]),ye("black")}}catch(R){console.error("AI move error:",R)}finally{Fe(!1)}},500))},st=function(){if(l==="online"&&Xe){he.warning("\u5DF2\u6709\u8FDB\u884C\u4E2D\u7684\u5BF9\u5C40\uFF0C\u8BF7\u5148\u7ED3\u675F\u5F53\u524D\u6E38\u620F");return}O(Ee()),ye("red"),Ne(null),je([]),ke(null),me(null),Pe(null),Ue([]),yr([]),g("online"),Ve(!1),H("connecting"),re(""),localStorage.removeItem("chess_is_joiner"),he.info("\u5DF2\u5207\u6362\u5230\u8054\u673A\u6A21\u5F0F\uFF0C\u8BF7\u521B\u5EFA\u6216\u52A0\u5165\u623F\u95F4")},St=(0,j.useCallback)(function(s){if(!s||s.mode!=="online"||!s.roomId)return!1;try{return console.log("\u6062\u590D\u4E4B\u524D\u7684\u6E38\u620F\u72B6\u6001",s),g("online"),re(s.roomId),H(s.onlineStatus||"waiting"),ue(s.playerColor||"red"),ne(s.opponentColor||"black"),o(s.opponentUserId||""),ge(s.opponentInfo||null),s.board&&O(s.board),s.moveHistory&&je(s.moveHistory),s.lastMove&&ke(s.lastMove),s.currentPlayer&&ye(s.currentPlayer),s.checkPosition&&me(s.checkPosition),s.isCheck!==void 0&&Be(s.isCheck),Ve(!0),!0}catch(m){return console.error("\u6062\u590D\u6E38\u620F\u72B6\u6001\u5931\u8D25:",m),!1}},[]),lt=function(m){m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),ra())},ot=function(m){if(!m.piece)return"";var w=G[m.piece.player][m.piece.type],h=m.from.col+1,b=m.from.row+1,S=m.to.col+1,R=m.to.row+1,X=function(sr){var Mr=["\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D","\u4E03","\u516B","\u4E5D"];return Mr[sr-1]||String(sr)},q;if(m.piece.player==="red"){var te=10-h,J=10-S;if(h===S){var $e=R>b?"\u8FDB":"\u9000",Ye=Math.abs(R-b);q="".concat(X(te)).concat($e).concat(X(Ye))}else b===R?q="".concat(X(te),"\u5E73").concat(X(J)):q="".concat(X(te)).concat(R>b?"\u8FDB":"\u9000").concat(X(J))}else if(h===S){var Ke=R>b?"\u8FDB":"\u9000",pr=Math.abs(R-b);q="".concat(h).concat(Ke).concat(pr)}else b===R?q="".concat(h,"\u5E73").concat(S):q="".concat(h).concat(R>b?"\u8FDB":"\u9000").concat(S);return"".concat(m.number,". ").concat(w).concat(q)},it=function(){if(!(l==="single"&&Oe.length<2||l==="self"&&Oe.length<1||mr||Se)){var m=l==="single"?2:1,w=Oe.slice(0,-m);je(w);var h=Ee(c);w.forEach(function(R){h[R.to.row][R.to.col]=R.piece,h[R.from.row][R.from.col]=null}),O(h),ye(l==="single"?N:T==="red"?"black":"red"),ke(w.length>0?{from:w[w.length-1].from,to:w[w.length-1].to}:null);var b=Le(h,T);if(b.inCheck){var S=er(h,T);me(S)}else me(null);Be(!1),Re(!1),Me(null)}},ut=function(){if(!(a!=null&&a.id)){he.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}H("connecting");var m=c;console.log("\u51C6\u5907\u521B\u5EFA/\u52A0\u5165\u623F\u95F4\uFF0C\u5F53\u524D\u6E38\u620F\u7C7B\u578B: ".concat(m)),Sr.current=!1,ea.current=!1,nn(function(){D?ct():(c!==m&&(console.log("\u6E38\u620F\u7C7B\u578B\u53D1\u751F\u53D8\u5316\uFF0C\u4ECE ".concat(c," \u6062\u590D\u4E3A ").concat(m)),x(m)),dt())})},ct=function(){tn(D)},dt=function(){localStorage.removeItem("chess_is_joiner"),ue("red"),ne("black"),console.log("\u6B63\u5728\u521B\u5EFA\u623F\u95F4\uFF0C\u4F60\u5C06\u6267\u7EA2\u5148\u624B\uFF0C\u6E38\u620F\u7C7B\u578B: ".concat(c)),Pn()},ft=function(){var m=N==="red"?"black":"red";ue(m),Fe(!1),O(Ee(c)),ye("red"),Ne(null),je([]),ke(null),me(null),Pe(null),Ue([]),Be(!1),Re(!1),Me(null),Fr(!1);var w=Ee(c);m==="black"&&l==="single"&&(Fe(!0),setTimeout(function(){try{var h=kr(w,"red");if(h){var b=Je(w,h.from,h.to,c);O(b),ke({from:h.from,to:h.to});var S=w[h.from.row][h.from.col];S&&je([{from:h.from,to:h.to,piece:S,capturedPiece:w[h.to.row][h.to.col]||null,number:1}]),ye("black")}}catch(R){console.error("AI move error:",R)}finally{Fe(!1)}},500))},vt=function(){Fe(!1),O(Ee(c)),ye("red"),Ne(null),je([]),ke(null),me(null),Pe(null),Ue([]),Be(!1),Re(!1),Me(null),Fr(!1);var m=Ee(c);N==="black"&&l==="single"&&(Fe(!0),setTimeout(function(){try{var w=kr(m,"red");if(w){var h=Je(m,w.from,w.to,c);O(h),ke({from:w.from,to:w.to});var b=m[w.from.row][w.from.col];b&&je([{from:w.from,to:w.to,piece:b,capturedPiece:m[w.to.row][w.to.col]||null,number:1}]),ye("black")}}catch(S){console.error("AI move error:",S)}finally{Fe(!1)}},500))};if(!Xe)return console.log("\u5F53\u524D\u72B6\u6001: gameMode=",l,", gameStarted=",Xe,", onlineStatus=",M),(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br to-indigo-50 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"bg-white p-12 rounded-2xl shadow-xl max-w-lg w-full text-center",children:[(0,n.jsx)("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"\u4E2D\u56FD\u8C61\u68CB"}),(0,n.jsx)("p",{className:"text-gray-600 mb-12",children:"\u5343\u5E74\u4F20\u7EDF\u6587\u5316\uFF0C\u667A\u6167\u7684\u5BF9\u51B3"}),(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-xl font-medium mb-4",children:"\u9009\u62E9\u6E38\u620F\u6A21\u5F0F"}),(0,n.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,n.jsxs)("button",{type:"button",className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",onClick:function(){return g("single")},children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("div",{style:{backgroundColor:l==="single"?"rgba(172,229,178,0.95)":"white",color:"white"},className:"w-5 h-5 rounded-full border-2 border-gray-800"}),(0,n.jsx)("span",{className:"font-medium text-gray-800",children:"\u5355\u4EBA VS AI"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"\u672C\u5730\u5BF9\u5F08"})]}),(0,n.jsxs)("button",{type:"button",onClick:function(){return g("self")},className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("div",{style:{backgroundColor:l==="self"?"rgba(172,229,178,0.95)":"white",color:"white"},className:"w-5 h-5 rounded-full border-2 border-gray-800"}),(0,n.jsx)("span",{className:"font-medium text-gray-800",children:"\u81EA\u6211\u5BF9\u5F08"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"\u672C\u5730\u5BF9\u5F08"})]}),(0,n.jsxs)("button",{type:"button",onClick:st,className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("div",{style:{backgroundColor:l==="online"?"rgba(172,229,178,0.95)":"white",color:"white"},className:"w-5 h-5 rounded-full border-2 border-gray-800"}),(0,n.jsx)("span",{className:"font-medium text-gray-800",children:"\u8054\u673A\u5BF9\u6218"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"\u5728\u7EBF\u5BF9\u5F08"})]})]})]}),Hr,l==="online"&&(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-xl font-medium mb-4",children:"\u9009\u62E9\u6E38\u620F\u7C7B\u578B"}),(0,n.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,n.jsxs)("button",{type:"button",className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",onClick:function(){return x("normal")},children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("div",{style:{backgroundColor:c==="normal"?"rgba(172,229,178,0.95)":"white",color:"white"},className:"w-5 h-5 rounded-full border-2 border-gray-800"}),(0,n.jsx)("span",{className:"font-medium text-gray-800",children:"\u666E\u901A\u6A21\u5F0F"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"\u4F20\u7EDF\u73A9\u6CD5"})]}),(0,n.jsxs)("button",{type:"button",className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",onClick:function(){return x("hidden")},children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("div",{style:{backgroundColor:c==="hidden"?"rgba(172,229,178,0.95)":"white",color:"white"},className:"w-5 h-5 rounded-full border-2 border-gray-800"}),(0,n.jsx)("span",{className:"font-medium text-gray-800",children:"\u63ED\u68CB\u6A21\u5F0F"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"\u6697\u68CB\u73A9\u6CD5"})]})]}),(0,n.jsx)("div",{className:"mt-4 text-sm text-gray-500",children:c==="normal"?(0,n.jsx)("p",{children:"\u4F20\u7EDF\u4E2D\u56FD\u8C61\u68CB\u73A9\u6CD5\uFF0C\u53CC\u65B9\u8F6E\u6D41\u79FB\u52A8\u68CB\u5B50\u3002"}):(0,n.jsx)("p",{children:"\u63ED\u68CB\u6A21\u5F0F\uFF1A\u6240\u6709\u68CB\u5B50\u521D\u59CB\u4E3A\u6697\u68CB\uFF0C\u79FB\u52A8\u65F6\u7FFB\u5F00\uFF0C\u6309\u89C4\u5219\u79FB\u52A8\u3002"})}),(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsx)(wn.Z,{type:"text",placeholder:"\u8F93\u5165\u623F\u95F4\u53F7\uFF08\u7559\u7A7A\u521B\u5EFA\u65B0\u623F\u95F4\uFF09",value:D,onChange:function(m){return re(m.target.value)},className:"border p-2 rounded-lg mb-4 w-full"}),(0,n.jsx)(Xr.ZP,{onClick:ut,type:"primary",className:"w-full",children:D?"\u52A0\u5165\u623F\u95F4":"\u521B\u5EFA\u623F\u95F4"})]})]}),(l==="single"||l==="self")&&(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-xl font-medium mb-4",children:"\u9009\u62E9\u6E38\u620F\u7C7B\u578B"}),(0,n.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,n.jsxs)("button",{type:"button",className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",onClick:function(){return x("normal")},children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("div",{style:{backgroundColor:c==="normal"?"rgba(172,229,178,0.95)":"white",color:"white"},className:"w-5 h-5 rounded-full border-2 border-gray-800"}),(0,n.jsx)("span",{className:"font-medium text-gray-800",children:"\u666E\u901A\u6A21\u5F0F"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"\u4F20\u7EDF\u73A9\u6CD5"})]}),(0,n.jsxs)("button",{type:"button",className:"group px-8 py-4 bg-white border-2 border-gray-200 rounded-xl hover:border-gray-300 transition-all duration-200 transform hover:scale-105",onClick:function(){return x("hidden")},children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("div",{style:{backgroundColor:c==="hidden"?"rgba(172,229,178,0.95)":"white",color:"white"},className:"w-5 h-5 rounded-full border-2 border-gray-800"}),(0,n.jsx)("span",{className:"font-medium text-gray-800",children:"\u63ED\u68CB\u6A21\u5F0F"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"\u6697\u68CB\u73A9\u6CD5"})]})]}),(0,n.jsx)("div",{className:"mt-4 text-sm text-gray-500",children:c==="normal"?(0,n.jsx)("p",{children:"\u4F20\u7EDF\u4E2D\u56FD\u8C61\u68CB\u73A9\u6CD5\uFF0C\u53CC\u65B9\u8F6E\u6D41\u79FB\u52A8\u68CB\u5B50\u3002"}):(0,n.jsx)("p",{children:"\u63ED\u68CB\u6A21\u5F0F\uFF1A\u6240\u6709\u68CB\u5B50\u521D\u59CB\u4E3A\u6697\u68CB\uFF0C\u79FB\u52A8\u65F6\u7FFB\u5F00\uFF0C\u6309\u89C4\u5219\u79FB\u52A8\u3002"})})]}),(l==="single"||l==="self")&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-medium mb-8 text-gray-800",children:"\u9009\u62E9\u60A8\u7684\u6267\u5B50\u989C\u8272"}),(0,n.jsxs)("div",{className:"flex gap-6 justify-center mb-6",children:[(0,n.jsxs)("button",{type:"button",onClick:function(){nr("red"),na("red")},style:{backgroundColor:"#c12c1f"},className:"group px-8 py-4 bg-gray-900 text-white rounded-xl hover:bg-gray-800 transition-all duration-200 transform hover:scale-105",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("div",{className:"w-5 h-5 rounded-full border-2 border-gray-700",style:{backgroundColor:"#c12c1f",borderColor:"#dd7694"}}),(0,n.jsx)("span",{className:"font-medium",children:"\u6267\u7EA2\u5148\u624B"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-300",children:"First Move"})]}),(0,n.jsxs)("button",{type:"button",onClick:function(){nr("black"),na("black")},className:"group px-8 py-4 bg-gray-900 text-white rounded-xl hover:bg-gray-800 transition-all duration-200 transform hover:scale-105",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("div",{className:"w-5 h-5 rounded-full bg-black border-2 border-gray-700"}),(0,n.jsx)("span",{className:"font-medium",children:"\u6267\u9ED1\u540E\u624B"})]}),(0,n.jsx)("span",{className:"text-sm text-gray-400 group-hover:text-gray-600",children:"Second Move"})]})]})]})]})});var ht=function(){Pa(!rn)};return(0,n.jsxs)("div",{className:"min-h-screen bg-indigo-50",children:[(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-stretch",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-4",children:[l==="online"&&(0,n.jsx)("div",{className:"mb-3 bg-purple-50 border border-purple-100 rounded-lg p-3",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(M==="playing"?"bg-green-500":"bg-yellow-500")}),(0,n.jsxs)("span",{className:"text-sm text-purple-800",children:[M==="connecting"&&"\u8FDE\u63A5\u4E2D...",M==="waiting"&&"\u7B49\u5F85\u5BF9\u624B\u52A0\u5165 (\u623F\u95F4\u53F7\u{1F3E0}: ".concat(D,")"),M==="playing"&&"\u5BF9\u6218\u4E2D - \u4F60\u6267".concat(N==="red"?"\u7EA2\u5148\u624B":"\u9ED1\u540E\u624B")]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[M==="waiting"&&(0,n.jsx)(Xr.ZP,{type:"primary",size:"small",onClick:at,disabled:zr,className:"bg-purple-500 hover:bg-purple-600",children:zr?"\u51B7\u5374\u4E2D (".concat(Qa,"s)"):"\u53D1\u9001\u9080\u8BF7"}),(M==="playing"||M==="waiting")&&(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden",children:(0,n.jsx)("img",{src:(Z==null?void 0:Z.avatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(A||"opponent"),alt:"\u5BF9\u624B\u5934\u50CF",className:"w-full h-full object-cover"})}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-800",children:M==="waiting"?"\u7B49\u5F85\u5BF9\u624B...":(Z==null?void 0:Z.name)||(A?"\u5BF9\u624B ".concat(A.slice(-4)):"\u7B49\u5F85\u5BF9\u624B...")}),(0,n.jsxs)("div",{className:"text-xs font-medium",style:{color:$==="red"?"#dc2626":"#000000"},children:["\u6267",$==="red"?"\u7EA2\u5148\u624B":"\u9ED1\u540E\u624B"]})]})]}),(M==="playing"||M==="waiting")&&(0,n.jsx)("div",{className:"w-px h-8 bg-gray-200"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-800",children:(a==null?void 0:a.userName)||"\u6E38\u5BA2"}),(0,n.jsxs)("div",{className:"text-xs font-medium",style:{color:N==="red"?"#dc2626":"#000000"},children:["\u6267",N==="red"?"\u7EA2\u5148\u624B":"\u9ED1\u540E\u624B"]})]}),(0,n.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden",children:(0,n.jsx)("img",{src:(a==null?void 0:a.userAvatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat((a==null?void 0:a.id)||"visitor"),alt:"\u73A9\u5BB6\u5934\u50CF",className:"w-full h-full object-cover"})})]})]})]})}),Hr,(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("button",{onClick:function(){Ve(!1),g("single"),O(Ee()),ye("red"),Ne(null),je([]),ke(null),me(null),yr([]),Er(""),re("")},className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[(0,n.jsx)(bn.Z,{className:"w-5 h-5"}),(0,n.jsx)("span",{className:"font-medium",children:"\u8FD4\u56DE"})]}),l==="single"&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"\u4E2D\u56FD\u8C61\u68CB"}),(0,n.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(mr?"bg-green-500 animate-pulse":"bg-gray-300")}),(0,n.jsx)("span",{className:"text-sm text-gray-600",children:mr?"AI \u601D\u8003\u4E2D...":"\u7B49\u5F85\u843D\u5B50"})]})]}),l==="self"&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"\u4E2D\u56FD\u8C61\u68CB"}),(0,n.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(T==="red"?"bg-red-500":"bg-black")}),(0,n.jsx)("span",{className:"text-sm text-gray-600",children:T==="red"?"\u7EA2\u65B9\u56DE\u5408":"\u9ED1\u65B9\u56DE\u5408"})]})]}),(l==="single"||l==="self")&&(0,n.jsxs)("div",{className:"flex gap-3",children:[c!=="hidden"&&(0,n.jsxs)("button",{type:"button",onClick:it,disabled:Oe.length<1||mr||!!Se,className:"px-4 py-2 rounded-lg flex items-center gap-2 ".concat(Oe.length<1||mr||Se?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-amber-500 text-white hover:bg-amber-600"," transition-colors"),children:[(0,n.jsx)(bn.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{className:"font-medium",children:"\u6094\u68CB"})]}),(0,n.jsxs)("button",{type:"button",onClick:function(){return Fr(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,n.jsx)(Ca.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{className:"font-medium",children:"\u91CD\u65B0\u5F00\u59CB"})]})]})]}),Se&&(0,n.jsxs)("div",{className:"mb-3 bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-center justify-center gap-3",children:[(0,n.jsx)(Cn.Z,{className:"w-6 h-6 text-yellow-600"}),(0,n.jsx)("span",{className:"text-lg font-medium text-yellow-800",children:l==="self"?"".concat(Se.winner==="red"?"\u7EA2\u65B9":"\u9ED1\u65B9","\u83B7\u80DC\uFF01"):Se.winner===N?"\u606D\u559C\u4F60\u8D62\u4E86\uFF01":l==="online"?"\u5BF9\u624B\u5C0F\u80DC\uFF0C\u518D\u63A5\u518D\u5389":"AI \u8D62\u4E86\uFF0C\u518D\u63A5\u518D\u5389\uFF01"})]}),!Se&&(0,n.jsxs)("div",{className:"mb-3 bg-blue-50 border border-blue-100 rounded-lg p-3 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full ".concat(T===N||l==="self"?"animate-pulse":""),style:{backgroundColor:T==="red"?"#dc2626":"#000000",boxShadow:T===N||l==="self"?"0 0 8px 3px rgba(59, 130, 246, 0.5)":"none"}}),(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"font-medium text-gray-900 flex items-center gap-2 ".concat(T===N||l==="self"?"text-blue-600":""),children:T===N||l==="self"?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{className:"relative flex h-3 w-3 mr-1",children:[(0,n.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-500 opacity-75"}),(0,n.jsx)("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-blue-600"})]}),(0,n.jsx)("span",{children:l==="self"?"".concat(T==="red"?"\u7EA2\u65B9":"\u9ED1\u65B9","\u56DE\u5408"):"\u4F60\u7684\u56DE\u5408"}),Le(z,T).inCheck&&(0,n.jsxs)("span",{className:"text-red-500 text-xs ml-2",children:["\uFF08",l==="self"?"".concat(T==="red"?"\u7EA2\u65B9":"\u9ED1\u65B9"):"\u4F60","\u6B63\u5728\u88AB\u5C06\u519B\uFF01\uFF09"]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"text-gray-500",children:l==="online"?"\u5BF9\u624B\u56DE\u5408":"AI\u56DE\u5408"}),cr&&(0,n.jsx)("span",{className:"text-xs text-gray-500 italic ml-1",children:l==="online"?"\u7B49\u5F85\u5BF9\u65B9\u843D\u5B50...":"AI\u601D\u8003\u4E2D..."})]})})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"w-5 h-5 flex items-center justify-center",children:"\u23F1\uFE0F"}),(0,n.jsxs)("span",{children:["\u56DE\u5408 ",Oe.length+1]})]}),l==="single"&&(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"w-5 h-5 flex items-center justify-center",children:"\u{1F9E0}"}),(0,n.jsx)("span",{children:"AI \u96BE\u5EA6: \u5C0F\u5B66\u751F"})]})]})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center w-full",children:[(0,n.jsx)("div",{className:"flex justify-center w-full",children:(0,n.jsx)(xa,{board:z,onPieceSelect:et,onMoveSelect:rt,selectedPosition:oe,validMoves:qr,lastMove:cr,checkPosition:gr,disabled:l==="self"?!!Se:mr||T!==N||!!Se,isFlipped:N==="black"?!rn:rn})}),(0,n.jsxs)("button",{type:"button",onClick:ht,className:"mt-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition-colors flex items-center gap-2",children:[(0,n.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("path",{d:"M9 16H15V10H21L12 2L3 10H9V16Z",fill:"currentColor"}),(0,n.jsx)("path",{d:"M15 8H9V14H3L12 22L21 14H15V8Z",fill:"currentColor",fillOpacity:"0.3"})]}),(0,n.jsx)("span",{className:"font-medium",children:"\u5207\u6362\u68CB\u76D8\u65B9\u5411"})]})]}),dr&&dr.eatingPiece&&(0,n.jsx)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 text-center",children:(0,n.jsx)("div",{className:"animate-capture",children:(0,n.jsxs)("span",{className:"text-4xl font-bold",style:{color:dr.player==="red"?"#dc2626":"#000000",textShadow:"0 0 15px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 165, 0, 0.6)"},children:[G[dr.player][dr.eatingPiece.type],"\u5403",G[dr.piece.player][dr.piece.type],"\uFF01"]})})}),Br&&Za&&(0,n.jsx)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 text-center",children:(0,n.jsx)("div",{className:"animate-check-text",children:(0,n.jsx)("span",{className:"text-4xl font-bold",style:{color:T===N?"#000000":"#dc2626",textShadow:"0 0 15px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 0, 0, 0.6)"},children:"\u5C06\u519B\uFF01"})})})]})}),(l==="online"||l==="single")&&(0,n.jsx)("div",{className:"lg:w-96 w-full flex items-center",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 flex flex-col w-full",style:{height:"min(calc(100vh - 6rem), 800px)"},children:[l==="online"&&(0,n.jsxs)("div",{className:"flex border-b mb-6",children:[(0,n.jsx)("button",{onClick:function(){return Un("chat")},className:"flex-1 py-3 px-4 text-center font-medium transition-all duration-200 ".concat(Tr==="chat"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,n.jsx)(ja.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{children:"\u804A\u5929\u5BA4"})]})}),(0,n.jsx)("button",{onClick:function(){return Un("history")},className:"flex-1 py-3 px-4 text-center font-medium transition-all duration-200 ".concat(Tr==="history"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,n.jsx)(jn.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{children:"\u5BF9\u6218\u8BB0\u5F55"})]})})]}),l==="online"&&Tr==="chat"&&(0,n.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,n.jsxs)("div",{className:"h-[500px] overflow-y-auto mb-4 space-y-4 px-2",style:{height:"500px"},children:[Jn.map(function(s){return(0,n.jsx)("div",{className:"flex ".concat(a!=null&&a.id&&String(s.sender.id)===String(a.id)?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-[85%] ".concat(a!=null&&a.id&&String(s.sender.id)===String(a.id)?"order-2":"order-1"),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1.5 ".concat(a!=null&&a.id&&String(s.sender.id)===String(a.id)?"justify-end":"justify-start"),children:[(0,n.jsx)("span",{className:"text-sm text-gray-800 font-medium",children:s.sender.name}),(0,n.jsx)("span",{className:"text-xs text-gray-400",children:new Date(s.timestamp).toLocaleTimeString()})]}),(0,n.jsx)("div",{className:"rounded-2xl px-4 py-2.5 ".concat(a!=null&&a.id&&String(s.sender.id)===String(a.id)?"bg-blue-50 text-gray-800 rounded-br-none border border-blue-100":"bg-gray-50 text-gray-800 rounded-bl-none border border-gray-100"),children:s.content})]})},s.id)}),(0,n.jsx)("div",{ref:Qn})]}),(0,n.jsxs)("div",{className:"flex gap-3 mt-auto pt-4 pb-4 border-t",children:[(0,n.jsx)(wn.Z.TextArea,{value:Pr,onChange:function(m){return Er(m.target.value)},onKeyDown:lt,placeholder:"\u8F93\u5165\u6D88\u606F...",autoSize:{minRows:1,maxRows:4},className:"flex-1"}),(0,n.jsx)(Xr.ZP,{type:"primary",onClick:ra,className:"px-6",children:"\u53D1\u9001"})]})]}),(l==="single"||l==="online"&&Tr==="history")&&(0,n.jsx)("div",{className:"flex-1 overflow-y-auto",children:Oe.length===0?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[(0,n.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-50 flex items-center justify-center mb-3",children:(0,n.jsx)(jn.Z,{className:"w-8 h-8"})}),(0,n.jsx)("p",{children:"\u6682\u65E0\u843D\u5B50"})]}):(0,n.jsx)("div",{className:"space-y-2",children:Oe.map(function(s,m){var w;return(0,n.jsx)("div",{className:"p-3 rounded-lg cursor-pointer transition-all duration-200 ".concat(m===Oe.length-1?"bg-blue-50 border border-blue-100 shadow-sm":"hover:bg-gray-50 border border-transparent hover:border-gray-100"),children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-5 h-5 rounded-full",style:{backgroundColor:((w=s.piece)===null||w===void 0?void 0:w.player)==="red"?"#dc2626":"#000000"}}),(0,n.jsx)("span",{className:"font-medium text-gray-800",children:ot(s)})]})},m)})})})]})})]})}),Oa&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 max-w-md w-full",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u91CD\u65B0\u5F00\u59CB"}),(0,n.jsx)("button",{onClick:function(){return Fr(!1)},className:"text-gray-400 hover:text-gray-600",children:(0,n.jsx)(kn.Z,{className:"w-5 h-5"})})]}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"\u8BF7\u9009\u62E9\u91CD\u65B0\u5F00\u59CB\u7684\u65B9\u5F0F\uFF1A"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("button",{type:"button",onClick:vt,className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 ".concat(N==="red"?"ring-2 ring-gray-400":N==="black"?"ring-2 ring-gray-600":""),children:[(0,n.jsx)("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:N==="red"?"#dc2626":"#000000"}}),(0,n.jsxs)("span",{className:"font-medium",children:["\u7EE7\u7EED",N==="red"?"\u6267\u7EA2\u5148\u624B":"\u6267\u9ED1\u540E\u624B"]})]}),(0,n.jsxs)("button",{type:"button",onClick:ft,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors flex items-center justify-center gap-2",children:[(0,n.jsx)("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:N==="red"?"#000000":"#dc2626"}}),(0,n.jsxs)("span",{className:"font-medium text-gray-800",children:["\u6539\u4E3A",N==="red"?"\u6267\u9ED1\u540E\u624B":"\u6267\u7EA2\u5148\u624B"]})]}),l==="single"&&(0,n.jsx)("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-xs text-yellow-800 mb-3",children:(0,n.jsx)("p",{children:"\u5728\u6B64\u7248\u672C\u4E2D\u60A8\u53EF\u4EE5\u81EA\u7531\u8D70\u68CB\uFF0C\u5373\u4F7F\u4F1A\u88AB\u5C06\u519B\u3002AI\u4ECD\u4F1A\u9075\u5FAA\u6807\u51C6\u89C4\u5219\u4E0D\u4F1A\u81EA\u6740\u3002"})}),(0,n.jsx)("button",{type:"button",onClick:function(){return Fr(!1)},className:"w-full px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",children:"\u53D6\u6D88"})]})]})}),Wa&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 max-w-md w-full",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u6E38\u620F\u7ED3\u675F"}),(0,n.jsx)("button",{onClick:function(){return Qe(!1)},className:"text-gray-400 hover:text-gray-600",children:(0,n.jsx)(kn.Z,{className:"w-5 h-5"})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-6",children:[(0,n.jsx)(Cn.Z,{className:"w-8 h-8 text-yellow-600"}),(0,n.jsx)("span",{className:"text-lg font-medium text-gray-800",children:(Se==null?void 0:Se.winner)===N?"\u606D\u559C\u4F60\u8D62\u4E86\uFF01":"\u5BF9\u624B\u5C0F\u80DC\uFF0C\u518D\u63A5\u518D\u5389"})]}),(0,n.jsx)("div",{className:"space-y-3",children:(0,n.jsx)("button",{type:"button",onClick:tt,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg hover:border-gray-300 transition-colors flex items-center justify-center gap-2",children:(0,n.jsx)("span",{className:"font-medium text-gray-800",children:"\u9000\u51FA\u623F\u95F4"})})})]})})]})}var Ba=Fa},7651:function(se,V,C){C.d(V,{o:function(){return j}});var Q=C(84169),pe=C.n(Q),xe=C(29957),lr=C.n(xe),wr=C(75204),fe=C.n(wr),We=C(98919),B=C(68872),Ie=C(44737),I=function(){function De(){var be=this;pe()(this,De),fe()(this,"ws",null),fe()(this,"reconnectAttempts",0),fe()(this,"maxReconnectAttempts",5),fe()(this,"reconnectTimeout",null),fe()(this,"messageHandlers",new Map),fe()(this,"isManuallyClosed",!1),fe()(this,"notificationInterval",null),fe()(this,"isWindowFocused",!0),fe()(this,"handleWindowFocus",function(){be.isWindowFocused=!0,be.notificationInterval&&((0,Ie.I0)(be.notificationInterval),be.notificationInterval=null)}),fe()(this,"handleWindowBlur",function(){be.isWindowFocused=!1}),this.addMessageHandler("error",function(ie){B.ZP.error(ie.data||"\u53D1\u751F\u9519\u8BEF")}),window.addEventListener("focus",this.handleWindowFocus),window.addEventListener("blur",this.handleWindowBlur)}return lr()(De,[{key:"isConnected",value:function(){var ie;return((ie=this.ws)===null||ie===void 0?void 0:ie.readyState)===WebSocket.OPEN}},{key:"connect",value:function(ie){var Ae,G=this;this.isManuallyClosed||((Ae=this.ws)===null||Ae===void 0?void 0:Ae.readyState)!==WebSocket.OPEN&&(this.ws=new WebSocket(We.QF+ie),this.ws.onopen=function(){var n;if(console.log("WebSocket\u8FDE\u63A5\u6210\u529F"),G.reconnectAttempts=0,((n=G.ws)===null||n===void 0?void 0:n.readyState)===WebSocket.OPEN){var _e;(_e=G.ws)===null||_e===void 0||_e.send(JSON.stringify({type:1}))}else B.ZP.error("WebSocket\u8FDE\u63A5\u5931\u8D25")},this.ws.onclose=function(){if(console.log("WebSocket\u8FDE\u63A5\u5173\u95ED"),G.ws=null,!G.isManuallyClosed&&G.reconnectAttempts<G.maxReconnectAttempts){var n=Math.min(1e3*Math.pow(2,G.reconnectAttempts),1e4);G.reconnectTimeout=setTimeout(function(){G.reconnectAttempts++,G.connect(ie)},n)}},this.ws.onmessage=function(n){try{var _e=JSON.parse(n.data),br=G.messageHandlers.get(_e.type)||[];if(br.forEach(function(jr){return jr(_e)}),_e.type==="chat"&&!G.isWindowFocused){G.notificationInterval&&(0,Ie.I0)(G.notificationInterval);var Cr=(0,Ie.pM)(_e.data.content||"\u65B0\u6D88\u606F");Cr&&(G.notificationInterval=Cr)}}catch(jr){console.error("\u5904\u7406WebSocket\u6D88\u606F\u5931\u8D25:",jr)}},this.ws.onerror=function(n){console.error("WebSocket\u9519\u8BEF:",n),B.ZP.error("\u8FDE\u63A5\u53D1\u751F\u9519\u8BEF")},setInterval(function(){var n;((n=G.ws)===null||n===void 0?void 0:n.readyState)===WebSocket.OPEN&&G.ws.send(JSON.stringify({type:4}))},25e3))}},{key:"disconnect",value:function(){this.isManuallyClosed=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null),this.notificationInterval&&((0,Ie.I0)(this.notificationInterval),this.notificationInterval=null),window.removeEventListener("focus",this.handleWindowFocus),window.removeEventListener("blur",this.handleWindowBlur)}},{key:"send",value:function(ie){var Ae;((Ae=this.ws)===null||Ae===void 0?void 0:Ae.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(ie)):B.ZP.error("WebSocket\u8FDE\u63A5\u5DF2\u65AD\u5F00")}},{key:"addMessageHandler",value:function(ie,Ae){var G;this.messageHandlers.has(ie)||this.messageHandlers.set(ie,[]),(G=this.messageHandlers.get(ie))===null||G===void 0||G.push(Ae)}},{key:"removeMessageHandler",value:function(ie,Ae){var G=this.messageHandlers.get(ie);if(G){var n=G.indexOf(Ae);n!==-1&&G.splice(n,1)}}},{key:"clearMessageHandlers",value:function(){var ie=this.messageHandlers.get("error")||[];this.messageHandlers.clear(),this.messageHandlers.set("error",ie)}}],[{key:"getInstance",value:function(){return De.instance||(De.instance=new De),De.instance}}]),De}();fe()(I,"instance",void 0);var j=I.getInstance()},91373:function(se,V,C){C.d(V,{Z:function(){return fe}});var Q=C(67294);const pe=We=>We.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),xe=(...We)=>We.filter((B,Ie,I)=>!!B&&B.trim()!==""&&I.indexOf(B)===Ie).join(" ").trim();var lr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const wr=(0,Q.forwardRef)((G,Ae)=>{var n=G,{color:We="currentColor",size:B=24,strokeWidth:Ie=2,absoluteStrokeWidth:I,className:j="",children:De,iconNode:be}=n,ie=sn(n,["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"]);return(0,Q.createElement)("svg",$r(ca($r({ref:Ae},lr),{width:B,height:B,stroke:We,strokeWidth:I?Number(Ie)*24/Number(B):Ie,className:xe("lucide",j)}),ie),[...be.map(([_e,br])=>(0,Q.createElement)(_e,br)),...Array.isArray(De)?De:[De]])});const fe=(We,B)=>{const Ie=(0,Q.forwardRef)((be,De)=>{var ie=be,{className:I}=ie,j=sn(ie,["className"]);return(0,Q.createElement)(wr,$r({ref:De,iconNode:B,className:xe(`lucide-${pe(We)}`,I)},j))});return Ie.displayName=`${We}`,Ie}},53219:function(se,V,C){C.d(V,{Z:function(){return xe}});var Q=C(91373);const pe=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],xe=(0,Q.Z)("ArrowLeft",pe)},47737:function(se,V,C){C.d(V,{Z:function(){return xe}});var Q=C(91373);const pe=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],xe=(0,Q.Z)("MessageSquare",pe)},6620:function(se,V,C){C.d(V,{Z:function(){return xe}});var Q=C(91373);const pe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],xe=(0,Q.Z)("RotateCcw",pe)},43777:function(se,V,C){C.d(V,{Z:function(){return xe}});var Q=C(91373);const pe=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],xe=(0,Q.Z)("Timer",pe)},1470:function(se,V,C){C.d(V,{Z:function(){return xe}});var Q=C(91373);const pe=[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]],xe=(0,Q.Z)("Trophy",pe)},41352:function(se,V,C){C.d(V,{Z:function(){return xe}});var Q=C(91373);const pe=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],xe=(0,Q.Z)("X",pe)}}]);
}());